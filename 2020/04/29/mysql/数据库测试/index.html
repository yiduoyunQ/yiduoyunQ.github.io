<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yiduoyunq.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="mysql版本5.71234567select version();+-----------+| version() |+-----------+| 5.7.29    |+-----------+1 row in set (0.01 sec)  范围查询包含非key字段1个字符，4000W12345678910111213141516select date, length(name), coun">
<meta property="og:type" content="article">
<meta property="og:title" content="数据库测试">
<meta property="og:url" content="https://yiduoyunq.github.io/2020/04/29/mysql/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B5%8B%E8%AF%95/index.html">
<meta property="og:site_name" content="yiduoyunQ">
<meta property="og:description" content="mysql版本5.71234567select version();+-----------+| version() |+-----------+| 5.7.29    |+-----------+1 row in set (0.01 sec)  范围查询包含非key字段1个字符，4000W12345678910111213141516select date, length(name), coun">
<meta property="article:published_time" content="2020-04-29T21:46:23.000Z">
<meta property="article:modified_time" content="2020-11-16T14:37:21.414Z">
<meta property="article:author" content="yiduoyunQ">
<meta property="article:tag" content="测试">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://yiduoyunq.github.io/2020/04/29/mysql/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B5%8B%E8%AF%95/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>数据库测试 | yiduoyunQ</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">yiduoyunQ</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://yiduoyunq.github.io/2020/04/29/mysql/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B5%8B%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yiduoyunQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yiduoyunQ">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          数据库测试
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-29 21:46:23" itemprop="dateCreated datePublished" datetime="2020-04-29T21:46:23+00:00">2020-04-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-11-16 14:37:21" itemprop="dateModified" datetime="2020-11-16T14:37:21+00:00">2020-11-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h2><h3 id="版本5-7"><a href="#版本5-7" class="headerlink" title="版本5.7"></a>版本5.7</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">version</span>();</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| version() |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| 5.7.29    |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="范围查询包含非key字段"><a href="#范围查询包含非key字段" class="headerlink" title="范围查询包含非key字段"></a>范围查询包含非key字段</h3><h4 id="1个字符，4000W"><a href="#1个字符，4000W" class="headerlink" title="1个字符，4000W"></a>1个字符，4000W</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">date</span>, <span class="keyword">length</span>(<span class="keyword">name</span>), <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">group</span> <span class="keyword">by</span> <span class="built_in">date</span>, <span class="keyword">name</span>;</span><br><span class="line">+<span class="comment">---------------------+--------------+----------+</span></span><br><span class="line">| date                | length(name) | count(*) |</span><br><span class="line">+<span class="comment">---------------------+--------------+----------+</span></span><br><span class="line">| 2020-04-01 00:00:00 |            1 |  4194304 |</span><br><span class="line">| 2020-04-02 00:00:00 |            1 |  4194304 |</span><br><span class="line">| 2020-04-03 00:00:00 |            1 |  4194304 |</span><br><span class="line">| 2020-04-04 00:00:00 |            1 |  4194304 |</span><br><span class="line">| 2020-04-05 00:00:00 |            1 |  4194304 |</span><br><span class="line">| 2020-04-06 00:00:00 |            1 |  4194304 |</span><br><span class="line">| 2020-04-07 00:00:00 |            1 |  4194304 |</span><br><span class="line">| 2020-04-08 00:00:00 |            1 |  4194304 |</span><br><span class="line">| 2020-04-09 00:00:00 |            1 |  4194304 |</span><br><span class="line">| 2020-04-10 00:00:00 |            1 |  4194304 |</span><br><span class="line">+<span class="comment">---------------------+--------------+----------+</span></span><br><span class="line">10 rows in <span class="keyword">set</span> (<span class="number">5</span> <span class="keyword">min</span> <span class="number">19.25</span> sec)</span><br></pre></td></tr></table></figure>

<h5 id="90-范围查询，带text字段，不走索引"><a href="#90-范围查询，带text字段，不走索引" class="headerlink" title="90%范围查询，带text字段，不走索引"></a>90%范围查询，带text字段，不走索引</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="built_in">date</span> &gt;= <span class="string">'2020/04/01 00:00:00'</span> <span class="keyword">and</span> <span class="built_in">date</span> &lt; <span class="string">'2020/04/10 00:00:00'</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows     | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | test  | NULL       | ALL  | uk1           | NULL | NULL    | NULL | 41863640 |    50.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.13</span> sec)</span><br></pre></td></tr></table></figure>

<h5 id="10-范围查询，带text字段，不走索引"><a href="#10-范围查询，带text字段，不走索引" class="headerlink" title="10%范围查询，带text字段，不走索引"></a>10%范围查询，带text字段，不走索引</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> <span class="keyword">id</span>, <span class="built_in">date</span>, <span class="keyword">name</span> <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="built_in">date</span> &gt;= <span class="string">'2020/04/01 00:00:00'</span> <span class="keyword">and</span> <span class="built_in">date</span> &lt; <span class="string">'2020/04/02 00:00:00'</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows     | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | test  | NULL       | ALL  | uk1           | NULL | NULL    | NULL | 41863640 |    19.10 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.12</span> sec)</span><br></pre></td></tr></table></figure>

<h5 id="树高度"><a href="#树高度" class="headerlink" title="树高度"></a>树高度</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> b.name, a.name, index_id, <span class="keyword">type</span>, a.space, a.PAGE_NO <span class="keyword">FROM</span> information_schema.INNODB_SYS_INDEXES a, information_schema.INNODB_SYS_TABLES b <span class="keyword">WHERE</span> a.table_id = b.table_id <span class="keyword">AND</span> a.space &lt;&gt; <span class="number">0</span> <span class="keyword">and</span> b.name=<span class="string">'test/test'</span>;</span><br><span class="line">+<span class="comment">-----------+---------+----------+------+-------+---------+</span></span><br><span class="line">| name      | name    | index_id | type | space | PAGE_NO |</span><br><span class="line">+<span class="comment">-----------+---------+----------+------+-------+---------+</span></span><br><span class="line">| test/test | PRIMARY |       93 |    3 |    60 |       3 |</span><br><span class="line">| test/test | uk1     |       94 |    0 |    60 |       4 |</span><br><span class="line">+<span class="comment">-----------+---------+----------+------+-------+---------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.08</span> sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 主键 3*16384+64，level为0x02，高度为3</span><br><span class="line"><span class="meta">$</span><span class="bash"> hexdump -s 49216 -n 10 test.ibd</span></span><br><span class="line">000c040 00 02 00 00 00 00 00 00 00 5d</span><br><span class="line">000c04a</span><br><span class="line">// uk1 4*16384+64，level为0x02，高度为3</span><br><span class="line"><span class="meta">$</span><span class="bash"> hexdump -s 65600 -n 10 test.ibd</span></span><br><span class="line">0010040 00 02 00 00 00 00 00 00 00 5e</span><br><span class="line">001004a</span><br></pre></td></tr></table></figure>

<h4 id="5个字符，4000W"><a href="#5个字符，4000W" class="headerlink" title="5个字符，4000W"></a>5个字符，4000W</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">date</span>, <span class="keyword">length</span>(<span class="keyword">name</span>), <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">group</span> <span class="keyword">by</span> <span class="built_in">date</span>, <span class="keyword">name</span>;</span><br><span class="line">+<span class="comment">---------------------+--------------+----------+</span></span><br><span class="line">| date                | length(name) | count(*) |</span><br><span class="line">+<span class="comment">---------------------+--------------+----------+</span></span><br><span class="line">| 2020-04-01 00:00:00 |            5 |  4194304 |</span><br><span class="line">| 2020-04-02 00:00:00 |            5 |  4194304 |</span><br><span class="line">| 2020-04-03 00:00:00 |            5 |  4194304 |</span><br><span class="line">| 2020-04-04 00:00:00 |            5 |  4194304 |</span><br><span class="line">| 2020-04-05 00:00:00 |            5 |  4194304 |</span><br><span class="line">| 2020-04-06 00:00:00 |            5 |  4194304 |</span><br><span class="line">| 2020-04-07 00:00:00 |            5 |  4194304 |</span><br><span class="line">| 2020-04-08 00:00:00 |            5 |  4194304 |</span><br><span class="line">| 2020-04-09 00:00:00 |            5 |  4194304 |</span><br><span class="line">| 2020-04-10 00:00:00 |            5 |  4194304 |</span><br><span class="line">+<span class="comment">---------------------+--------------+----------+</span></span><br><span class="line">10 rows in <span class="keyword">set</span> (<span class="number">4</span> <span class="keyword">min</span> <span class="number">55.59</span> sec)</span><br></pre></td></tr></table></figure>

<h5 id="90-范围查询，带text字段，不走索引-1"><a href="#90-范围查询，带text字段，不走索引-1" class="headerlink" title="90%范围查询，带text字段，不走索引"></a>90%范围查询，带text字段，不走索引</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="built_in">date</span> &gt;= <span class="string">'2020/04/01 00:00:00'</span> <span class="keyword">and</span> <span class="built_in">date</span> &lt; <span class="string">'2020/04/10 00:00:00'</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows     | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | test  | NULL       | ALL  | uk1           | NULL | NULL    | NULL | 41853552 |    50.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.03</span> sec)</span><br></pre></td></tr></table></figure>

<h5 id="10-范围查询，带text字段，不走索引-1"><a href="#10-范围查询，带text字段，不走索引-1" class="headerlink" title="10%范围查询，带text字段，不走索引"></a>10%范围查询，带text字段，不走索引</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> <span class="keyword">id</span>, <span class="built_in">date</span>, <span class="keyword">name</span> <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="built_in">date</span> &gt;= <span class="string">'2020/04/01 00:00:00'</span> <span class="keyword">and</span> <span class="built_in">date</span> &lt; <span class="string">'2020/04/02 00:00:00'</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows     | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | test  | NULL       | ALL  | uk1           | NULL | NULL    | NULL | 41853552 |    19.11 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="200个字符，4000W"><a href="#200个字符，4000W" class="headerlink" title="200个字符，4000W"></a>200个字符，4000W</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">date</span>, <span class="keyword">length</span>(<span class="keyword">name</span>), <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">group</span> <span class="keyword">by</span> <span class="built_in">date</span>, <span class="keyword">name</span>;</span><br><span class="line">+<span class="comment">---------------------+--------------+----------+</span></span><br><span class="line">| date                | length(name) | count(*) |</span><br><span class="line">+<span class="comment">---------------------+--------------+----------+</span></span><br><span class="line">| 2020-04-01 00:00:00 |          200 |  4194304 |</span><br><span class="line">| 2020-04-02 00:00:00 |          200 |  4194304 |</span><br><span class="line">| 2020-04-03 00:00:00 |          200 |  4194304 |</span><br><span class="line">| 2020-04-04 00:00:00 |          200 |  4194304 |</span><br><span class="line">| 2020-04-05 00:00:00 |          200 |  4194304 |</span><br><span class="line">| 2020-04-06 00:00:00 |          200 |  4194304 |</span><br><span class="line">| 2020-04-07 00:00:00 |          200 |  4194304 |</span><br><span class="line">| 2020-04-08 00:00:00 |          200 |  4194304 |</span><br><span class="line">| 2020-04-09 00:00:00 |          200 |  4194304 |</span><br><span class="line">| 2020-04-10 00:00:00 |          200 |  4194304 |</span><br><span class="line">+<span class="comment">---------------------+--------------+----------+</span></span><br><span class="line">10 rows in <span class="keyword">set</span> (<span class="number">6</span> <span class="keyword">min</span> <span class="number">58.89</span> sec)</span><br></pre></td></tr></table></figure>

<h5 id="90-范围查询，带text字段，不走索引-2"><a href="#90-范围查询，带text字段，不走索引-2" class="headerlink" title="90%范围查询，带text字段，不走索引"></a>90%范围查询，带text字段，不走索引</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="built_in">date</span> &gt;= <span class="string">'2020/04/01 00:00:00'</span> <span class="keyword">and</span> <span class="built_in">date</span> &lt; <span class="string">'2020/04/10 00:00:00'</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows     | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | test  | NULL       | ALL  | uk1           | NULL | NULL    | NULL | 41342675 |    50.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h5 id="90-范围查询，仅查询索引字段或count-计数，走索引"><a href="#90-范围查询，仅查询索引字段或count-计数，走索引" class="headerlink" title="90%范围查询，仅查询索引字段或count(*)计数，走索引"></a>90%范围查询，仅查询索引字段或count(*)计数，走索引</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> <span class="built_in">date</span> <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="built_in">date</span> &gt;= <span class="string">'2020/04/01 00:00:00'</span> <span class="keyword">and</span> <span class="built_in">date</span> &lt; <span class="string">'2020/04/10 00:00:00'</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+------+---------+------+----------+----------+--------------------------+</span></span><br><span class="line">| id | select_type | table | partitions | type  | possible_keys | key  | key_len | ref  | rows     | filtered | Extra                    |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+------+---------+------+----------+----------+--------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | test  | NULL       | range | uk1           | uk1  | 4       | NULL | 20671337 |   100.00 | Using where; Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+------+---------+------+----------+----------+--------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="built_in">date</span> &gt;= <span class="string">'2020/04/01 00:00:00'</span> <span class="keyword">and</span> <span class="built_in">date</span> &lt; <span class="string">'2020/04/10 00:00:00'</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+------+---------+------+----------+----------+--------------------------+</span></span><br><span class="line">| id | select_type | table | partitions | type  | possible_keys | key  | key_len | ref  | rows     | filtered | Extra                    |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+------+---------+------+----------+----------+--------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | test  | NULL       | range | uk1           | uk1  | 4       | NULL | 20671337 |   100.00 | Using where; Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+------+---------+------+----------+----------+--------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<h5 id="10-范围查询，带text字段，不走索引-2"><a href="#10-范围查询，带text字段，不走索引-2" class="headerlink" title="10%范围查询，带text字段，不走索引"></a>10%范围查询，带text字段，不走索引</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="built_in">date</span> &gt;= <span class="string">'2020/04/01 00:00:00'</span> <span class="keyword">and</span> <span class="built_in">date</span> &lt; <span class="string">'2020/04/02 00:00:00'</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows     | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | test  | NULL       | ALL  | uk1           | NULL | NULL    | NULL | 41342675 |    19.34 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h5 id="主键查询固定走索引"><a href="#主键查询固定走索引" class="headerlink" title="主键查询固定走索引"></a>主键查询固定走索引</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="keyword">id</span> &gt; <span class="number">1</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+---------+---------+------+----------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type  | possible_keys | key     | key_len | ref  | rows     | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+---------+---------+------+----------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | test  | NULL       | range | PRIMARY       | PRIMARY | 4       | NULL | 20671337 |   100.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+---------+---------+------+----------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.02</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="200个字符，1W"><a href="#200个字符，1W" class="headerlink" title="200个字符，1W"></a>200个字符，1W</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">date</span>, <span class="keyword">length</span>(<span class="keyword">name</span>), <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">group</span> <span class="keyword">by</span> <span class="built_in">date</span>, <span class="keyword">name</span>;</span><br><span class="line">+<span class="comment">---------------------+--------------+----------+</span></span><br><span class="line">| date                | length(name) | count(*) |</span><br><span class="line">+<span class="comment">---------------------+--------------+----------+</span></span><br><span class="line">| 2020-04-01 00:00:00 |          200 |     1024 |</span><br><span class="line">| 2020-04-02 00:00:00 |          200 |     1024 |</span><br><span class="line">| 2020-04-03 00:00:00 |          200 |     1024 |</span><br><span class="line">| 2020-04-04 00:00:00 |          200 |     1024 |</span><br><span class="line">| 2020-04-05 00:00:00 |          200 |     1024 |</span><br><span class="line">| 2020-04-06 00:00:00 |          200 |     1024 |</span><br><span class="line">| 2020-04-07 00:00:00 |          200 |     1024 |</span><br><span class="line">| 2020-04-08 00:00:00 |          200 |     1024 |</span><br><span class="line">| 2020-04-09 00:00:00 |          200 |     1024 |</span><br><span class="line">| 2020-04-10 00:00:00 |          200 |     1024 |</span><br><span class="line">+<span class="comment">---------------------+--------------+----------+</span></span><br><span class="line">10 rows in <span class="keyword">set</span> (<span class="number">0.11</span> sec)</span><br></pre></td></tr></table></figure>

<h5 id="90-范围查询，带text字段，不走索引-3"><a href="#90-范围查询，带text字段，不走索引-3" class="headerlink" title="90%范围查询，带text字段，不走索引"></a>90%范围查询，带text字段，不走索引</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="built_in">date</span> &gt;= <span class="string">'2020/04/01 00:00:00'</span> <span class="keyword">and</span> <span class="built_in">date</span> &lt; <span class="string">'2020/04/10 00:00:00'</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows  | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | test  | NULL       | ALL  | uk1           | NULL | NULL    | NULL | 10140 |    90.89 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+-------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h5 id="10-范围查询，带text字段，走索引"><a href="#10-范围查询，带text字段，走索引" class="headerlink" title="10%范围查询，带text字段，走索引"></a>10%范围查询，带text字段，走索引</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="built_in">date</span> &gt;= <span class="string">'2020/04/01 00:00:00'</span> <span class="keyword">and</span> <span class="built_in">date</span> &lt; <span class="string">'2020/04/02 00:00:00'</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">| id | select_type | table | partitions | type  | possible_keys | key  | key_len | ref  | rows | filtered | Extra                 |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">|  1 | SIMPLE      | test  | NULL       | range | uk1           | uk1  | 4       | NULL | 1024 |   100.00 | Using index condition |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="200个字符，4000W，耗时比较"><a href="#200个字符，4000W，耗时比较" class="headerlink" title="200个字符，4000W，耗时比较"></a>200个字符，4000W，耗时比较</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> time mysql <span class="built_in">test</span> -e <span class="string">"select * from test where date &gt;= '2020/04/01 00:00:00' and date &lt; '2020/04/02 00:00:00'"</span> &gt; /dev/null</span></span><br><span class="line"></span><br><span class="line">real 2m54.656s</span><br><span class="line">user 1m4.118s</span><br><span class="line">sys 0m4.271s</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> time mysql <span class="built_in">test</span> -e <span class="string">"select * from test force index(uk1) where date &gt;= '2020/04/01 00:00:00' and date &lt; '2020/04/02 00:00:00'"</span> &gt; /dev/null</span></span><br><span class="line"></span><br><span class="line">real 1m43.517s</span><br><span class="line">user 0m59.562s</span><br><span class="line">sys 0m3.959s</span><br></pre></td></tr></table></figure>

<h4 id="语句"><a href="#语句" class="headerlink" title="语句"></a>语句</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">test</span>;</span><br><span class="line">+<span class="comment">-------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| Table | <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                                                                                                                                                                                            |</span><br><span class="line">+<span class="comment">-------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| <span class="keyword">test</span>  | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`test`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`date`</span> <span class="built_in">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">text</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`uk1`</span> (<span class="string">`date`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">42990946</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 |</span><br><span class="line">+<span class="comment">-------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">test</span> <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">'2020/04/01'</span>, <span class="string">'a'</span>);</span><br><span class="line"><span class="comment">-- insert into test values(1,'2020/04/01', repeat('a', 5));</span></span><br><span class="line"><span class="comment">-- insert into test values(1,'2020/04/01', repeat('a', 200));</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">test</span>(<span class="built_in">date</span>, <span class="keyword">name</span>) <span class="keyword">select</span> <span class="string">'2020/04/01'</span>,<span class="keyword">name</span> <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="built_in">date</span> =<span class="string">'2020/04/01'</span>;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="autoincrement-uuid-insert速度比较"><a href="#autoincrement-uuid-insert速度比较" class="headerlink" title="autoincrement / uuid  insert速度比较"></a>autoincrement / uuid  insert速度比较</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test02(</span><br><span class="line"><span class="keyword">id</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line"><span class="built_in">date</span> <span class="built_in">timestamp</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="keyword">current_timestamp</span> <span class="keyword">on</span> <span class="keyword">update</span> <span class="keyword">current_timestamp</span>,</span><br><span class="line"><span class="keyword">name</span> <span class="built_in">text</span>,</span><br><span class="line">primary <span class="keyword">key</span>(<span class="keyword">id</span>),<span class="keyword">key</span> uk1 (<span class="built_in">date</span>)) <span class="keyword">engine</span>=<span class="keyword">innodb</span> <span class="keyword">default</span> <span class="keyword">charset</span>=utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> test01 <span class="keyword">where</span> <span class="built_in">date</span>=<span class="string">'2020/04/01'</span>;</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| count(*) |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| 1048577 |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test01(<span class="built_in">date</span>,<span class="keyword">name</span>) <span class="keyword">select</span> <span class="string">'2020/04/15'</span>,<span class="keyword">name</span> <span class="keyword">from</span> test01 <span class="keyword">where</span> <span class="built_in">date</span>=<span class="string">'2020/04/01'</span>;</span><br><span class="line">Query OK, 1048577 rows affected (12.73 sec)</span><br><span class="line">Records: 1048577  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> test02 <span class="keyword">where</span> <span class="built_in">date</span>=<span class="string">'2020/04/01'</span>;</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| count(*) |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| 1048577 |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test02(<span class="keyword">id</span>,<span class="built_in">date</span>,<span class="keyword">name</span>) <span class="keyword">select</span> <span class="keyword">replace</span>(<span class="keyword">uuid</span>(),<span class="string">'-'</span>,<span class="string">''</span>),<span class="string">'2020/04/15'</span>,<span class="keyword">name</span> <span class="keyword">from</span> test02 <span class="keyword">where</span> <span class="built_in">date</span>=<span class="string">'2020/04/01'</span>;</span><br><span class="line">Query OK, 1048576 rows affected (17.31 sec)</span><br><span class="line">Records: 1048576  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> test01 <span class="keyword">where</span> <span class="built_in">date</span>=<span class="string">'2020/04/01'</span>;</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| count(*) |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| 16777232 |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test01(<span class="built_in">date</span>,<span class="keyword">name</span>) <span class="keyword">select</span> <span class="string">'2020/04/30'</span>,<span class="keyword">name</span> <span class="keyword">from</span> test01 <span class="keyword">where</span> <span class="built_in">date</span>=<span class="string">'2020/04/01'</span>;</span><br><span class="line">Query OK, 16777232 rows affected (4 min 11.18 sec)</span><br><span class="line">Records: 16777232  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> test02 <span class="keyword">where</span> <span class="built_in">date</span>=<span class="string">'2020/04/01'</span>;</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| count(*) |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| 16777216 |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test02(<span class="keyword">id</span>,<span class="built_in">date</span>,<span class="keyword">name</span>) <span class="keyword">select</span> <span class="keyword">replace</span>(<span class="keyword">uuid</span>(),<span class="string">'-'</span>,<span class="string">''</span>),<span class="string">'2020/04/30'</span>,<span class="keyword">name</span> <span class="keyword">from</span> test02 <span class="keyword">where</span> <span class="built_in">date</span>=<span class="string">'2020/04/01'</span>;</span><br><span class="line">Query OK, 16777216 rows affected (5 min 41.65 sec)</span><br><span class="line">Records: 16777216  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>

<h3 id="view"><a href="#view" class="headerlink" title="view"></a>view</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> test01;</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| count(*) |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">|  1048576 |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.29</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> test_view;</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| count(*) |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| 10485760 |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">34.62</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> id1, id2 <span class="keyword">from</span>  test_view <span class="keyword">where</span> id1=<span class="number">500</span> <span class="keyword">and</span> id2 <span class="keyword">between</span> <span class="number">700</span> <span class="keyword">and</span> <span class="number">710</span>;</span><br><span class="line">+<span class="comment">----+-------------+------------+------------+------+---------------+-------------+---------+-------+---------+----------+-------------+</span></span><br><span class="line">| id | select_type | table      | partitions | type | possible_keys | key         | key_len | ref   | rows    | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+------------+------------+------+---------------+-------------+---------+-------+---------+----------+-------------+</span></span><br><span class="line">|  1 | PRIMARY     | &lt;derived2&gt; | NULL       | ref  | &lt;auto_key0&gt;   | &lt;auto_key0&gt; | 4       | const |  104695 |    11.11 | Using where |</span><br><span class="line">|  2 | DERIVED     | test01     | NULL       | ALL  | NULL          | NULL        | NULL    | NULL  | 1047386 |   100.00 | NULL        |</span><br><span class="line">|  3 | UNION       | test02     | NULL       | ALL  | NULL          | NULL        | NULL    | NULL  | 1046904 |   100.00 | NULL        |</span><br><span class="line">|  4 | UNION       | test03     | NULL       | ALL  | NULL          | NULL        | NULL    | NULL  | 1046904 |   100.00 | NULL        |</span><br><span class="line">|  5 | UNION       | test04     | NULL       | ALL  | NULL          | NULL        | NULL    | NULL  | 1046904 |   100.00 | NULL        |</span><br><span class="line">|  6 | UNION       | test05     | NULL       | ALL  | NULL          | NULL        | NULL    | NULL  | 1046904 |   100.00 | NULL        |</span><br><span class="line">|  7 | UNION       | test06     | NULL       | ALL  | NULL          | NULL        | NULL    | NULL  | 1046904 |   100.00 | NULL        |</span><br><span class="line">|  8 | UNION       | test07     | NULL       | ALL  | NULL          | NULL        | NULL    | NULL  | 1046904 |   100.00 | NULL        |</span><br><span class="line">|  9 | UNION       | test08     | NULL       | ALL  | NULL          | NULL        | NULL    | NULL  | 1046904 |   100.00 | NULL        |</span><br><span class="line">| 10 | UNION       | test09     | NULL       | ALL  | NULL          | NULL        | NULL    | NULL  | 1046904 |   100.00 | NULL        |</span><br><span class="line">| 11 | UNION       | test10     | NULL       | ALL  | NULL          | NULL        | NULL    | NULL  | 1046904 |   100.00 | NULL        |</span><br><span class="line">+<span class="comment">----+-------------+------------+------------+------+---------------+-------------+---------+-------+---------+----------+-------------+</span></span><br><span class="line">11 rows in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> id1, id2 <span class="keyword">from</span>  test_view_pk <span class="keyword">where</span> id1=<span class="number">500</span> <span class="keyword">and</span> id2 <span class="keyword">between</span> <span class="number">700</span> <span class="keyword">and</span> <span class="number">710</span>;</span><br><span class="line">+<span class="comment">----+-------------+------------+------------+-------+---------------+-------------+---------+-------+---------+----------+--------------------------+</span></span><br><span class="line">| id | select_type | table      | partitions | type  | possible_keys | key         | key_len | ref   | rows    | filtered | Extra                    |</span><br><span class="line">+<span class="comment">----+-------------+------------+------------+-------+---------------+-------------+---------+-------+---------+----------+--------------------------+</span></span><br><span class="line">|  1 | PRIMARY     | &lt;derived2&gt; | NULL       | ref   | &lt;auto_key0&gt;   | &lt;auto_key0&gt; | 4       | const |  104695 |    11.11 | Using where; Using index |</span><br><span class="line">|  2 | DERIVED     | test01     | NULL       | index | NULL          | PRIMARY     | 8       | NULL  | 1047386 |   100.00 | Using index              |</span><br><span class="line">|  3 | UNION       | test02     | NULL       | index | NULL          | PRIMARY     | 8       | NULL  | 1046904 |   100.00 | Using index              |</span><br><span class="line">|  4 | UNION       | test03     | NULL       | index | NULL          | PRIMARY     | 8       | NULL  | 1046904 |   100.00 | Using index              |</span><br><span class="line">|  5 | UNION       | test04     | NULL       | index | NULL          | PRIMARY     | 8       | NULL  | 1046904 |   100.00 | Using index              |</span><br><span class="line">|  6 | UNION       | test05     | NULL       | index | NULL          | PRIMARY     | 8       | NULL  | 1046904 |   100.00 | Using index              |</span><br><span class="line">|  7 | UNION       | test06     | NULL       | index | NULL          | PRIMARY     | 8       | NULL  | 1046904 |   100.00 | Using index              |</span><br><span class="line">|  8 | UNION       | test07     | NULL       | index | NULL          | PRIMARY     | 8       | NULL  | 1046904 |   100.00 | Using index              |</span><br><span class="line">|  9 | UNION       | test08     | NULL       | index | NULL          | PRIMARY     | 8       | NULL  | 1046904 |   100.00 | Using index              |</span><br><span class="line">| 10 | UNION       | test09     | NULL       | index | NULL          | PRIMARY     | 8       | NULL  | 1046904 |   100.00 | Using index              |</span><br><span class="line">| 11 | UNION       | test10     | NULL       | index | NULL          | PRIMARY     | 8       | NULL  | 1046904 |   100.00 | Using index              |</span><br><span class="line">+<span class="comment">----+-------------+------------+------------+-------+---------------+-------------+---------+-------+---------+----------+--------------------------+</span></span><br><span class="line">11 rows in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="语句-1"><a href="#语句-1" class="headerlink" title="语句"></a>语句</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`test01`</span> (</span><br><span class="line">  <span class="string">`id1`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`id2`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`name1`</span> <span class="built_in">text</span>,</span><br><span class="line">  <span class="string">`name2`</span> <span class="built_in">text</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id1`</span>, <span class="string">`id2`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- test02 -- test10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> test_view <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> test01</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> test02</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> test03</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> test04</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> test05</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> test06</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> test07</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> test08</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> test09</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> test10</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> test_view_pk <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> id1, id2 <span class="keyword">from</span> test01</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> id1, id2 <span class="keyword">from</span> test02</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> id1, id2 <span class="keyword">from</span> test03</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> id1, id2 <span class="keyword">from</span> test04</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> id1, id2 <span class="keyword">from</span> test05</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> id1, id2 <span class="keyword">from</span> test06</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> id1, id2 <span class="keyword">from</span> test07</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> id1, id2 <span class="keyword">from</span> test08</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> id1, id2 <span class="keyword">from</span> test09</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> id1, id2 <span class="keyword">from</span> test10</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">for i in &#123;1..1024&#125;</span><br><span class="line">do</span><br><span class="line">    s=""</span><br><span class="line">    for j in &#123;1..1024&#125;</span><br><span class="line">    do</span><br><span class="line">        s+="($i, $j, 'a', 'b')"</span><br><span class="line">        s+=","</span><br><span class="line">    done</span><br><span class="line">    mysql test -e "insert into test01 values$&#123;s%,&#125;" &amp;</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">wait</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test02 <span class="keyword">select</span> * <span class="keyword">from</span> test01;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test10 <span class="keyword">select</span> * <span class="keyword">from</span> test01;</span><br></pre></td></tr></table></figure>

<h3 id="binlog-row-image"><a href="#binlog-row-image" class="headerlink" title="binlog_row_image"></a>binlog_row_image</h3><p>full： before image和after image都为全量字段<br>minimal： before image仅用于区分记录字段(主键等)，after image仅语句指定字段(更新字段)</p>
<h4 id="create-table"><a href="#create-table" class="headerlink" title="create table"></a>create table</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`test`</span> (</span><br><span class="line">  <span class="string">`c1`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`c2`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`s1`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`s2`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`c1`</span>,<span class="string">`c2`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8</span><br></pre></td></tr></table></figure>

<h4 id="full"><a href="#full" class="headerlink" title="full"></a>full</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">test</span> <span class="keyword">values</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="string">'a1'</span>, <span class="string">'b1'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">### INSERT INTO `test`.`test`</span></span><br><span class="line"><span class="comment">### SET</span></span><br><span class="line"><span class="comment">###   @1=1 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @2=1 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @3='a1' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @4='b1' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> c1=<span class="number">1</span> <span class="keyword">and</span> c2=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">### DELETE FROM `test`.`test`</span></span><br><span class="line"><span class="comment">### WHERE</span></span><br><span class="line"><span class="comment">###   @1=1 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @2=1 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @3='a1' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @4='b1' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> test00 <span class="keyword">set</span> s2=<span class="string">'c123'</span> <span class="keyword">where</span> s1=<span class="string">'a1'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">### UPDATE `mysqltt`.`test00`</span></span><br><span class="line"><span class="comment">### WHERE</span></span><br><span class="line"><span class="comment">###   @1=1 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @2=1 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @3='a1' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @4='b1' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">### SET</span></span><br><span class="line"><span class="comment">###   @1=1 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @2=1 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @3='a1' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @4='c123' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">### UPDATE `mysqltt`.`test00`</span></span><br><span class="line"><span class="comment">### WHERE</span></span><br><span class="line"><span class="comment">###   @1=1 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @2=2 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @3='a1' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @4='b2' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">### SET</span></span><br><span class="line"><span class="comment">###   @1=1 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @2=2 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @3='a1' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @4='c123' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">### UPDATE `mysqltt`.`test00`</span></span><br><span class="line"><span class="comment">### WHERE</span></span><br><span class="line"><span class="comment">###   @1=1 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @2=3 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @3='a1' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @4='b3' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">### SET</span></span><br><span class="line"><span class="comment">###   @1=1 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @2=3 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @3='a1' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @4='c123' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br></pre></td></tr></table></figure>

<h4 id="minimal"><a href="#minimal" class="headerlink" title="minimal"></a>minimal</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">test</span> <span class="keyword">values</span>(<span class="number">2</span>, <span class="number">2</span>, <span class="string">'a2'</span>, <span class="string">'b2'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">### INSERT INTO `test`.`test`</span></span><br><span class="line"><span class="comment">### SET</span></span><br><span class="line"><span class="comment">###   @1=2 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @2=2 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @3='a2' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @4='b2' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> c1=<span class="number">2</span> <span class="keyword">and</span> c2=<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">### DELETE FROM `test`.`test`</span></span><br><span class="line"><span class="comment">### WHERE</span></span><br><span class="line"><span class="comment">###   @1=2 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @2=2 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> test00 <span class="keyword">set</span> s2=<span class="string">'d123'</span> <span class="keyword">where</span> s1=<span class="string">'a2'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">### UPDATE `mysqltt`.`test00`</span></span><br><span class="line"><span class="comment">### WHERE</span></span><br><span class="line"><span class="comment">###   @1=2 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @2=1 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">### SET</span></span><br><span class="line"><span class="comment">###   @4='d123' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">### UPDATE `mysqltt`.`test00`</span></span><br><span class="line"><span class="comment">### WHERE</span></span><br><span class="line"><span class="comment">###   @1=2 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @2=2 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">### SET</span></span><br><span class="line"><span class="comment">###   @4='d123' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br><span class="line"><span class="comment">### UPDATE `mysqltt`.`test00`</span></span><br><span class="line"><span class="comment">### WHERE</span></span><br><span class="line"><span class="comment">###   @1=2 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">###   @2=3 /* INT meta=0 nullable=0 is_null=0 */</span></span><br><span class="line"><span class="comment">### SET</span></span><br><span class="line"><span class="comment">###   @4='d123' /* VARSTRING(60) meta=60 nullable=1 is_null=0 */</span></span><br></pre></td></tr></table></figure>

<h3 id="使用备份idb快速恢复历史数据"><a href="#使用备份idb快速恢复历史数据" class="headerlink" title="使用备份idb快速恢复历史数据"></a>使用备份idb快速恢复历史数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">test</span> discard <span class="keyword">tablespace</span>;</span><br><span class="line">Query OK, 0 rows affected (45.11 sec)</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span>;</span><br><span class="line">ERROR 1814 (HY000): Tablespace has been discarded for table 'test'</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">table</span> <span class="keyword">test</span> <span class="keyword">for</span> <span class="keyword">export</span>;</span><br><span class="line">scp /backup_node/path_to_dat/test.ibd /recover_node/path_to_dat/</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">test</span> <span class="keyword">import</span> <span class="keyword">tablespace</span>;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (18.73 sec)</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">full</span> <span class="keyword">processlist</span>;</span><br><span class="line">+<span class="comment">----+------+-----------+------+---------+------+-------------+------------------------------------+</span></span><br><span class="line">| Id | User | Host      | db   | Command | Time | State       | Info                               |</span><br><span class="line">+<span class="comment">----+------+-----------+------+---------+------+-------------+------------------------------------+</span></span><br><span class="line">|  8 | root | localhost | test | Query   |   16 | System <span class="keyword">lock</span> | <span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">test</span> <span class="keyword">import</span> <span class="keyword">tablespace</span> |</span><br><span class="line">| <span class="number">12</span> | root | localhost | <span class="literal">NULL</span> | <span class="keyword">Query</span>   |    <span class="number">0</span> | <span class="keyword">starting</span>    | <span class="keyword">show</span> <span class="keyword">full</span> <span class="keyword">processlist</span>              |</span><br><span class="line">+<span class="comment">----+------+-----------+------+---------+------+-------------+------------------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">limit</span> <span class="number">1</span>;</span><br><span class="line">+<span class="comment">----+---------------------+-------+</span></span><br><span class="line">| id | date                | name  |</span><br><span class="line">+<span class="comment">----+---------------------+-------+</span></span><br><span class="line">|  1 | 2020-04-01 00:00:00 | aaaaa |</span><br><span class="line">+<span class="comment">----+---------------------+-------+</span></span><br></pre></td></tr></table></figure>

<h3 id="锁等待"><a href="#锁等待" class="headerlink" title="锁等待"></a>锁等待</h3><ul>
<li><code>show engine innodb status</code>看死锁/锁等待</li>
<li><code>information_schema.innodb_locks</code>和<code>information_schema.innodb_lock_waits</code>看锁关系信息</li>
<li><code>performance_schema.events_statements_history</code>和<code>performance_schema.threads</code>看<code>show processlist</code>中pid执行历史语句</li>
<li><code>information_schema.innodb_trx</code>看当前执行中未提交事务</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># session1</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> test.test01 <span class="keyword">where</span> id1=<span class="number">1</span> <span class="keyword">and</span> id2=<span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># session2</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> test.test01 <span class="keyword">where</span> id1=<span class="number">1</span> <span class="keyword">and</span> id2=<span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># session3</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">engine</span> <span class="keyword">innodb</span> <span class="keyword">status</span>\G;</span><br><span class="line"></span><br><span class="line">LIST OF TRANSACTIONS FOR EACH SESSION:</span><br><span class="line"><span class="comment">---TRANSACTION 281479529381440, not started</span></span><br><span class="line">0 <span class="keyword">lock</span> <span class="keyword">struct</span>(s), <span class="keyword">heap</span> <span class="keyword">size</span> <span class="number">1136</span>, <span class="number">0</span> <span class="keyword">row</span> <span class="keyword">lock</span>(s)</span><br><span class="line"><span class="comment">---TRANSACTION 160786, ACTIVE 16 sec starting index read</span></span><br><span class="line">mysql <span class="keyword">tables</span> <span class="keyword">in</span> <span class="keyword">use</span> <span class="number">1</span>, <span class="keyword">locked</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">LOCK</span> <span class="keyword">WAIT</span> <span class="number">2</span> <span class="keyword">lock</span> <span class="keyword">struct</span>(s), <span class="keyword">heap</span> <span class="keyword">size</span> <span class="number">1136</span>, <span class="number">1</span> <span class="keyword">row</span> <span class="keyword">lock</span>(s)</span><br><span class="line">MySQL <span class="keyword">thread</span> <span class="keyword">id</span> <span class="number">2</span>, OS <span class="keyword">thread</span> handle <span class="number">123145348661248</span>, <span class="keyword">query</span> <span class="keyword">id</span> <span class="number">74</span> localhost root updating</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> test01 <span class="keyword">where</span> id1=<span class="number">1</span> <span class="keyword">and</span> id2=<span class="number">1</span></span><br><span class="line"><span class="comment">------- TRX HAS BEEN WAITING 16 SEC FOR THIS LOCK TO BE GRANTED:</span></span><br><span class="line"><span class="built_in">RECORD</span> LOCKS <span class="keyword">space</span> <span class="keyword">id</span> <span class="number">66</span> page <span class="keyword">no</span> <span class="number">4</span> n bits <span class="number">552</span> <span class="keyword">index</span> PRIMARY <span class="keyword">of</span> <span class="keyword">table</span> <span class="string">`test`</span>.<span class="string">`test01`</span> trx <span class="keyword">id</span> <span class="number">160786</span> lock_mode X locks rec but <span class="keyword">not</span> gap waiting</span><br><span class="line"><span class="built_in">Record</span> <span class="keyword">lock</span>, <span class="keyword">heap</span> <span class="keyword">no</span> <span class="number">2</span> <span class="keyword">PHYSICAL</span> <span class="built_in">RECORD</span>: n_fields <span class="number">6</span>; compact format; info bits 32</span><br><span class="line"> 0: len 4; hex 80000001; asc     ;;</span><br><span class="line"> 1: len 4; hex 80000001; asc     ;;</span><br><span class="line"> 2: len 6; hex 000000027411; asc     t ;;</span><br><span class="line"> 3: len 7; hex 310000013f2879; asc 1   ?(y;;</span><br><span class="line"> 4: len 1; hex 61; asc a;;</span><br><span class="line"> 5: len 1; hex 62; asc b;;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># session4</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> information_schema.innodb_lock_waits;</span><br><span class="line">+<span class="comment">-------------------+-------------------+-----------------+------------------+</span></span><br><span class="line">| requesting_trx_id | requested_lock_id | blocking_trx_id | blocking_lock_id |</span><br><span class="line">+<span class="comment">-------------------+-------------------+-----------------+------------------+</span></span><br><span class="line">| 160787            | 160787:66:4:2     | 160785          | 160785:66:4:2    |</span><br><span class="line">+<span class="comment">-------------------+-------------------+-----------------+------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> information_schema.innodb_locks;</span><br><span class="line">+<span class="comment">---------------+-------------+-----------+-----------+-----------------+------------+------------+-----------+----------+-----------+</span></span><br><span class="line">| lock_id       | lock_trx_id | lock_mode | lock_type | lock_table      | lock_index | lock_space | lock_page | lock_rec | lock_data |</span><br><span class="line">+<span class="comment">---------------+-------------+-----------+-----------+-----------------+------------+------------+-----------+----------+-----------+</span></span><br><span class="line">| 160787:66:4:2 | 160787      | X         | RECORD    | `test`.`test01` | PRIMARY    |         66 |         4 |        2 | 1, 1      |</span><br><span class="line">| 160785:66:4:2 | 160785      | X         | RECORD    | `test`.`test01` | PRIMARY    |         66 |         4 |        2 | 1, 1      |</span><br><span class="line">+<span class="comment">---------------+-------------+-----------+-----------+-----------------+------------+------------+-----------+----------+-----------+</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># session5</span></span><br><span class="line"><span class="keyword">SELECT</span> THREAD_ID,TIMER_START,TIMER_END,TIMER_WAIT,SQL_TEXT,MESSAGE_TEXT <span class="keyword">FROM</span> performance_schema.events_statements_history <span class="keyword">WHERE</span> thread_id = (     <span class="keyword">SELECT</span> THREAD_ID <span class="keyword">FROM</span> performance_schema.threads <span class="keyword">WHERE</span> PROCESSLIST_ID = <span class="number">10</span> )\G</span><br><span class="line">*************************** <span class="number">1.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">   THREAD_ID: <span class="number">36</span></span><br><span class="line"> TIMER_START: <span class="number">2048071080000000</span></span><br><span class="line">   TIMER_END: <span class="number">2048071201000000</span></span><br><span class="line">  TIMER_WAIT: <span class="number">121000000</span></span><br><span class="line">    SQL_TEXT: <span class="keyword">select</span> @@version_comment <span class="keyword">limit</span> <span class="number">1</span></span><br><span class="line">MESSAGE_TEXT: <span class="literal">NULL</span></span><br><span class="line">*************************** <span class="number">2.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">   THREAD_ID: <span class="number">36</span></span><br><span class="line"> TIMER_START: <span class="number">2049834364000000</span></span><br><span class="line">   TIMER_END: <span class="number">2049834417000000</span></span><br><span class="line">  TIMER_WAIT: <span class="number">53000000</span></span><br><span class="line">    SQL_TEXT: <span class="keyword">begin</span></span><br><span class="line">MESSAGE_TEXT: <span class="literal">NULL</span></span><br><span class="line">*************************** <span class="number">3.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">   THREAD_ID: <span class="number">36</span></span><br><span class="line"> TIMER_START: <span class="number">2055696930000000</span></span><br><span class="line">   TIMER_END: <span class="number">2055730415000000</span></span><br><span class="line">  TIMER_WAIT: <span class="number">33485000000</span></span><br><span class="line">    SQL_TEXT: <span class="keyword">delete</span> <span class="keyword">from</span> test.test01 <span class="keyword">where</span> id1=<span class="number">1</span> <span class="keyword">and</span> id2=<span class="number">1</span></span><br><span class="line">MESSAGE_TEXT: <span class="literal">NULL</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> THREAD_ID,TIMER_START,TIMER_END,TIMER_WAIT,SQL_TEXT,MESSAGE_TEXT <span class="keyword">FROM</span> performance_schema.events_statements_history <span class="keyword">WHERE</span> thread_id = (     <span class="keyword">SELECT</span> THREAD_ID <span class="keyword">FROM</span> performance_schema.threads <span class="keyword">WHERE</span> PROCESSLIST_ID = <span class="number">12</span> )\G</span><br><span class="line">*************************** <span class="number">1.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">   THREAD_ID: <span class="number">38</span></span><br><span class="line"> TIMER_START: <span class="number">2197004107000000</span></span><br><span class="line">   TIMER_END: <span class="number">2197008105000000</span></span><br><span class="line">  TIMER_WAIT: <span class="number">3998000000</span></span><br><span class="line">    SQL_TEXT: <span class="keyword">select</span> @@version_comment <span class="keyword">limit</span> <span class="number">1</span></span><br><span class="line">MESSAGE_TEXT: <span class="literal">NULL</span></span><br><span class="line">*************************** <span class="number">2.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">   THREAD_ID: <span class="number">38</span></span><br><span class="line"> TIMER_START: <span class="number">2198577580000000</span></span><br><span class="line">   TIMER_END: <span class="number">2198577653000000</span></span><br><span class="line">  TIMER_WAIT: <span class="number">73000000</span></span><br><span class="line">    SQL_TEXT: <span class="keyword">begin</span></span><br><span class="line">MESSAGE_TEXT: <span class="literal">NULL</span></span><br><span class="line">*************************** <span class="number">3.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">   THREAD_ID: <span class="number">38</span></span><br><span class="line"> TIMER_START: <span class="number">2200660449000000</span></span><br><span class="line">   TIMER_END: <span class="number">2251869851000000</span></span><br><span class="line">  TIMER_WAIT: <span class="number">51209402000000</span></span><br><span class="line">    SQL_TEXT: <span class="keyword">delete</span> <span class="keyword">from</span> test.test01 <span class="keyword">where</span> id1=<span class="number">1</span> <span class="keyword">and</span> id2=<span class="number">1</span></span><br><span class="line">MESSAGE_TEXT: <span class="keyword">Lock</span> <span class="keyword">wait</span> <span class="keyword">timeout</span> exceeded; try restarting transaction</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># session 6</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> information_schema.innodb_trx\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">                    trx_id: 169733</span><br><span class="line">                 trx_state: <span class="keyword">LOCK</span> <span class="keyword">WAIT</span></span><br><span class="line">               trx_started: <span class="number">2020</span><span class="number">-07</span><span class="number">-08</span> <span class="number">23</span>:<span class="number">09</span>:<span class="number">47</span></span><br><span class="line">     trx_requested_lock_id: <span class="number">169733</span>:<span class="number">66</span>:<span class="number">4</span>:<span class="number">3</span></span><br><span class="line">          trx_wait_started: <span class="number">2020</span><span class="number">-07</span><span class="number">-08</span> <span class="number">23</span>:<span class="number">09</span>:<span class="number">47</span></span><br><span class="line">                trx_weight: <span class="number">2</span></span><br><span class="line">       trx_mysql_thread_id: <span class="number">3</span></span><br><span class="line">                 trx_query: <span class="keyword">delete</span> <span class="keyword">from</span> test.test01 <span class="keyword">where</span> id1=<span class="number">1</span> <span class="keyword">and</span> id2=<span class="number">2</span></span><br><span class="line">       trx_operation_state: <span class="keyword">starting</span> <span class="keyword">index</span> <span class="keyword">read</span></span><br><span class="line">         trx_tables_in_use: <span class="number">1</span></span><br><span class="line">         trx_tables_locked: <span class="number">1</span></span><br><span class="line">          trx_lock_structs: <span class="number">2</span></span><br><span class="line">     trx_lock_memory_bytes: <span class="number">1136</span></span><br><span class="line">           trx_rows_locked: <span class="number">1</span></span><br><span class="line">         trx_rows_modified: <span class="number">0</span></span><br><span class="line">   trx_concurrency_tickets: <span class="number">0</span></span><br><span class="line">       trx_isolation_level: <span class="keyword">READ</span> COMMITTED</span><br><span class="line">         trx_unique_checks: <span class="number">1</span></span><br><span class="line">    trx_foreign_key_checks: <span class="number">1</span></span><br><span class="line">trx_last_foreign_key_error: <span class="literal">NULL</span></span><br><span class="line"> trx_adaptive_hash_latched: <span class="number">0</span></span><br><span class="line"> trx_adaptive_hash_timeout: <span class="number">0</span></span><br><span class="line">          trx_is_read_only: <span class="number">0</span></span><br><span class="line">trx_autocommit_non_locking: <span class="number">0</span></span><br><span class="line">*************************** <span class="number">2.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">                    trx_id: <span class="number">169732</span></span><br><span class="line">                 trx_state: RUNNING</span><br><span class="line">               trx_started: <span class="number">2020</span><span class="number">-07</span><span class="number">-08</span> <span class="number">23</span>:<span class="number">09</span>:<span class="number">32</span></span><br><span class="line">     trx_requested_lock_id: <span class="literal">NULL</span></span><br><span class="line">          trx_wait_started: <span class="literal">NULL</span></span><br><span class="line">                trx_weight: <span class="number">3</span></span><br><span class="line">       trx_mysql_thread_id: <span class="number">2</span></span><br><span class="line">                 trx_query: <span class="literal">NULL</span></span><br><span class="line">       trx_operation_state: <span class="literal">NULL</span></span><br><span class="line">         trx_tables_in_use: <span class="number">0</span></span><br><span class="line">         trx_tables_locked: <span class="number">1</span></span><br><span class="line">          trx_lock_structs: <span class="number">2</span></span><br><span class="line">     trx_lock_memory_bytes: <span class="number">1136</span></span><br><span class="line">           trx_rows_locked: <span class="number">1</span></span><br><span class="line">         trx_rows_modified: <span class="number">1</span></span><br><span class="line">   trx_concurrency_tickets: <span class="number">0</span></span><br><span class="line">       trx_isolation_level: <span class="keyword">READ</span> COMMITTED</span><br><span class="line">         trx_unique_checks: <span class="number">1</span></span><br><span class="line">    trx_foreign_key_checks: <span class="number">1</span></span><br><span class="line">trx_last_foreign_key_error: <span class="literal">NULL</span></span><br><span class="line"> trx_adaptive_hash_latched: <span class="number">0</span></span><br><span class="line"> trx_adaptive_hash_timeout: <span class="number">0</span></span><br><span class="line">          trx_is_read_only: <span class="number">0</span></span><br><span class="line">trx_autocommit_non_locking: <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h3 id="partition"><a href="#partition" class="headerlink" title="partition"></a>partition</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">test</span>\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: test</span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">Table</span>: <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`test`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`date`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">text</span>,</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`id`</span> (<span class="string">`id`</span>,<span class="string">`date`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`uk1`</span> (<span class="string">`date`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">42990946</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">id</span>), <span class="built_in">date</span> <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">group</span> <span class="keyword">by</span> <span class="built_in">date</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">date</span>;</span><br><span class="line">+<span class="comment">-----------+---------------------+</span></span><br><span class="line">| count(id) | date                |</span><br><span class="line">+<span class="comment">-----------+---------------------+</span></span><br><span class="line">|   4194304 | 2020-04-01 00:00:00 |</span><br><span class="line">|   4194304 | 2020-04-02 00:00:00 |</span><br><span class="line">|   4194304 | 2020-04-03 00:00:00 |</span><br><span class="line">|   4194304 | 2020-04-04 00:00:00 |</span><br><span class="line">|   4194304 | 2020-04-05 00:00:00 |</span><br><span class="line">|   4194304 | 2020-04-06 00:00:00 |</span><br><span class="line">|   4194304 | 2020-04-07 00:00:00 |</span><br><span class="line">|   4194304 | 2020-04-08 00:00:00 |</span><br><span class="line">|   4194304 | 2020-04-09 00:00:00 |</span><br><span class="line">|   4194304 | 2020-04-10 00:00:00 |</span><br><span class="line">+<span class="comment">-----------+---------------------+</span></span><br><span class="line">10 rows in <span class="keyword">set</span> (<span class="number">19.10</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">where</span> <span class="built_in">date</span> &lt; <span class="string">'20200402'</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows     | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | test  | NULL       | ALL  | uk1           | NULL | NULL    | NULL | 41849498 |    19.87 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------+---------+------+----------+----------+-------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 约束</span></span><br><span class="line">ERROR 1503 (HY000): A PRIMARY KEY must include all columns in the table's partitioning function</span><br><span class="line"></span><br><span class="line">du -sh test.ibd</span><br><span class="line">2.1G   test.ibd</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">test</span> <span class="keyword">partition</span> <span class="keyword">by</span> <span class="keyword">range</span> <span class="keyword">columns</span>(<span class="built_in">date</span>)(</span><br><span class="line">  <span class="keyword">partition</span> p20200331 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="string">'20200401'</span>),</span><br><span class="line">  <span class="keyword">partition</span> p20200401 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="string">'20200402'</span>),</span><br><span class="line">  <span class="keyword">partition</span> p20200402 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="string">'20200403'</span>),</span><br><span class="line">  <span class="keyword">partition</span> p20200403 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="string">'20200404'</span>),</span><br><span class="line">  <span class="keyword">partition</span> p20200404 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="string">'20200405'</span>),</span><br><span class="line">  <span class="keyword">partition</span> p20200405 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="string">'20200406'</span>),</span><br><span class="line">  <span class="keyword">partition</span> p20200406 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="string">'20200407'</span>),</span><br><span class="line">  <span class="keyword">partition</span> p20200407 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="string">'20200408'</span>),</span><br><span class="line">  <span class="keyword">partition</span> p20200408 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="string">'20200409'</span>),</span><br><span class="line">  <span class="keyword">partition</span> p20200409 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="string">'20200410'</span>),</span><br><span class="line">  <span class="keyword">partition</span> p20200410 <span class="keyword">values</span> <span class="keyword">less</span> <span class="keyword">than</span> (<span class="string">'20200411'</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">du -sh test*.ibd</span><br><span class="line">112K	test<span class="comment">#P#p20200331.ibd</span></span><br><span class="line">225M	test<span class="comment">#P#p20200401.ibd</span></span><br><span class="line">225M	test<span class="comment">#P#p20200402.ibd</span></span><br><span class="line">225M	test<span class="comment">#P#p20200403.ibd</span></span><br><span class="line">225M	test<span class="comment">#P#p20200404.ibd</span></span><br><span class="line">225M	test<span class="comment">#P#p20200405.ibd</span></span><br><span class="line">225M	test<span class="comment">#P#p20200406.ibd</span></span><br><span class="line">225M	test<span class="comment">#P#p20200407.ibd</span></span><br><span class="line">225M	test<span class="comment">#P#p20200408.ibd</span></span><br><span class="line">225M	test<span class="comment">#P#p20200409.ibd</span></span><br><span class="line">225M	test<span class="comment">#P#p20200410.ibd</span></span><br><span class="line"> 44M	test01.ibd</span><br><span class="line"> 44M	test02.ibd</span><br><span class="line"> 44M	test03.ibd</span><br><span class="line"> 44M	test04.ibd</span><br><span class="line"> 44M	test05.ibd</span><br><span class="line"> 44M	test06.ibd</span><br><span class="line"> 44M	test07.ibd</span><br><span class="line"> 44M	test08.ibd</span><br><span class="line"> 44M	test09.ibd</span><br><span class="line"> 44M	test10.ibd</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">test</span>(<span class="built_in">date</span>,<span class="keyword">name</span>) <span class="keyword">values</span>(<span class="string">'20200430'</span>, <span class="string">'bbbbb'</span>);</span><br><span class="line">ERROR 1526 (HY000): Table has no partition for value from column_list</span><br></pre></td></tr></table></figure>

<h3 id="partition快速删除分区数据"><a href="#partition快速删除分区数据" class="headerlink" title="partition快速删除分区数据"></a>partition快速删除分区数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(<span class="keyword">id</span>), <span class="built_in">date</span> <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">group</span> <span class="keyword">by</span> <span class="built_in">date</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">date</span>;</span><br><span class="line">+<span class="comment">-----------+---------------------+</span></span><br><span class="line">| count(id) | date                |</span><br><span class="line">+<span class="comment">-----------+---------------------+</span></span><br><span class="line">|   1048576 | 2020-03-31 00:00:00 |</span><br><span class="line">|   1048576 | 2020-04-01 00:00:00 |</span><br><span class="line">|   1048576 | 2020-04-02 00:00:00 |</span><br><span class="line">|   1048576 | 2020-04-03 00:00:00 |</span><br><span class="line">|   1048576 | 2020-04-04 00:00:00 |</span><br><span class="line">+<span class="comment">-----------+---------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 阻塞DML，备份partition ibd物理文件</span></span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">table</span> <span class="keyword">test</span> <span class="keyword">for</span> <span class="keyword">export</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- discard</span></span><br><span class="line"><span class="keyword">unlock</span> <span class="keyword">tables</span>;<span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">test</span> discard <span class="keyword">tablespace</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 拷贝回保留partition ibd文件，删除需要清理partition</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">test</span> <span class="keyword">drop</span> <span class="keyword">partition</span> p20200331,p20200401;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- import</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">test</span> <span class="keyword">import</span> <span class="keyword">tablespace</span>;</span><br></pre></td></tr></table></figure>

<h3 id="MRR"><a href="#MRR" class="headerlink" title="MRR"></a>MRR</h3><blockquote>
<p>默认mrr_cost为on且代价非常高，直接关闭。<code>set @@optimizer_switch=&#39;mrr=on,mrr_cost_based=off&#39;</code></p>
</blockquote>
<p>2级索引查询对主键排序后回表，磁盘接近顺序IO</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> test01 <span class="keyword">where</span> id2 &gt; <span class="number">10</span> <span class="keyword">and</span> id2 &lt; <span class="number">20</span>;</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+------+---------+------+-------+----------+----------------------------------+</span></span><br><span class="line">| id | select_type | table  | partitions | type  | possible_keys | key  | key_len | ref  | rows  | filtered | Extra                            |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+------+---------+------+-------+----------+----------------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | test01 | NULL       | range | idx1          | idx1 | 4       | NULL | 17592 |   100.00 | Using index condition; Using MRR |</span><br><span class="line">+<span class="comment">----+-------------+--------+------------+-------+---------------+------+---------+------+-------+----------+----------------------------------+</span></span><br></pre></td></tr></table></figure>

<h3 id="自增变量未持久化"><a href="#自增变量未持久化" class="headerlink" title="自增变量未持久化"></a>自增变量未持久化</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> test_auto;</span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line">| id |</span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line">|  1 |</span><br><span class="line">|  2 |</span><br><span class="line">|  3 |</span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> test_auto <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_auto <span class="keyword">values</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> test_auto;</span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line">| id |</span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line">|  1 |</span><br><span class="line">|  2 |</span><br><span class="line">|  4 |</span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> test_auto <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">4</span>;</span><br><span class="line"><span class="comment">-- restart mysql server</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_auto <span class="keyword">values</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> test_auto;</span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line">| id |</span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line">|  1 |</span><br><span class="line">|  2 |</span><br><span class="line">|  3 |</span><br><span class="line">+<span class="comment">----+</span></span><br></pre></td></tr></table></figure>

<h3 id="DDL非原子"><a href="#DDL非原子" class="headerlink" title="DDL非原子"></a>DDL非原子</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span> <span class="keyword">like</span> <span class="string">'test1%'</span>;</span><br><span class="line">+<span class="comment">-------------------------+</span></span><br><span class="line">| Tables_in_test (test1%) |</span><br><span class="line">+<span class="comment">-------------------------+</span></span><br><span class="line">| test10                  |</span><br><span class="line">| test11                  |</span><br><span class="line">+<span class="comment">-------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> test11,test12;</span><br><span class="line">ERROR 1051 (42S02): Unknown table 'test.test12'</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span> <span class="keyword">like</span> <span class="string">'test1%'</span>;</span><br><span class="line">+<span class="comment">-------------------------+</span></span><br><span class="line">| Tables_in_test (test1%) |</span><br><span class="line">+<span class="comment">-------------------------+</span></span><br><span class="line">| test10                  |</span><br><span class="line">+<span class="comment">-------------------------+</span></span><br></pre></td></tr></table></figure>

<h3 id="创建降序索引仍为升序"><a href="#创建降序索引仍为升序" class="headerlink" title="创建降序索引仍为升序"></a>创建降序索引仍为升序</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t1(c1 <span class="built_in">int</span>,c2 <span class="built_in">int</span>,<span class="keyword">index</span> idx_c1_c2(c1,c2 <span class="keyword">desc</span>));</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> t1;</span><br><span class="line">+<span class="comment">-------+--------------------------------------------------------------------------------------+</span></span><br><span class="line">| Table | <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                         |</span><br><span class="line">+<span class="comment">-------+--------------------------------------------------------------------------------------+</span></span><br><span class="line">| t1    | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t1`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 |</span><br><span class="line">+<span class="comment">-------+--------------------------------------------------------------------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t1 <span class="keyword">select</span> <span class="keyword">rand</span>()*<span class="number">100000</span>, <span class="keyword">rand</span>()*<span class="number">100000</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t1 <span class="keyword">select</span> <span class="keyword">rand</span>()*<span class="number">100000</span>, <span class="keyword">rand</span>()*<span class="number">100000</span> <span class="keyword">from</span> t1;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> *<span class="keyword">from</span> t1 <span class="keyword">order</span> <span class="keyword">by</span> c1 , c2 <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">5</span>;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+------+---------+------+--------+----------+-----------------------------+</span></span><br><span class="line">| id | select_type | table | partitions | type  | possible_keys | key  | key_len | ref  | rows   | filtered | Extra                       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+------+---------+------+--------+----------+-----------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | t1    | NULL       | index | NULL          | idx1 | 10      | NULL | 327519 |   100.00 | Using index; Using filesort |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+------+---------+------+--------+----------+-----------------------------+</span></span><br></pre></td></tr></table></figure>

<h3 id="innodb-rollback-on-timeout"><a href="#innodb-rollback-on-timeout" class="headerlink" title="innodb_rollback_on_timeout"></a>innodb_rollback_on_timeout</h3><blockquote>
<p>需重启生效，影响事务原子性，建议设为<code>ON</code></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--my.cnf</span></span><br><span class="line"><span class="comment">--innodb_rollback_on_timeout = OFF</span></span><br><span class="line"><span class="comment">--innodb_lock_wait_timeout = 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- session1</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t1;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| c1   | c2   |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    1 |    1 |</span><br><span class="line">|    1 |    2 |</span><br><span class="line">|    2 |    1 |</span><br><span class="line">|    2 |    2 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> t1 <span class="keyword">set</span> c1=<span class="number">3</span> <span class="keyword">where</span> c1=<span class="number">1</span> <span class="keyword">and</span> c2=<span class="number">1</span>;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="comment">-- session2</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> t1 <span class="keyword">set</span> c1=<span class="number">3</span> <span class="keyword">where</span> c1=<span class="number">2</span> <span class="keyword">and</span> c2=<span class="number">2</span>;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="comment">-- session 1</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> t1 <span class="keyword">set</span> c1=<span class="number">3</span> <span class="keyword">where</span> c1=<span class="number">1</span> <span class="keyword">and</span> c2=<span class="number">1</span>;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> t1 <span class="keyword">set</span> c1=<span class="number">4</span> <span class="keyword">where</span> c1=<span class="number">2</span> <span class="keyword">and</span> c2=<span class="number">2</span>;</span><br><span class="line">ERROR 1205 (HY000): <span class="keyword">Lock</span> <span class="keyword">wait</span> <span class="keyword">timeout</span> exceeded; try restarting transaction</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t1;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| c1   | c2   |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    1 |    2 |</span><br><span class="line">|    2 |    1 |</span><br><span class="line">|    2 |    2 |</span><br><span class="line">|    3 |    1 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--my.cnf</span></span><br><span class="line"><span class="comment">--innodb_rollback_on_timeout = ON</span></span><br><span class="line"><span class="comment">--innodb_lock_wait_timeout = 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- session1</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t1;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| c1   | c2   |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    1 |    1 |</span><br><span class="line">|    1 |    2 |</span><br><span class="line">|    2 |    1 |</span><br><span class="line">|    2 |    2 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> t1 <span class="keyword">set</span> c1=<span class="number">3</span> <span class="keyword">where</span> c1=<span class="number">1</span> <span class="keyword">and</span> c2=<span class="number">1</span>;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="comment">-- session2</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> t1 <span class="keyword">set</span> c1=<span class="number">3</span> <span class="keyword">where</span> c1=<span class="number">2</span> <span class="keyword">and</span> c2=<span class="number">2</span>;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="comment">-- session 1</span></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> t1 <span class="keyword">set</span> c1=<span class="number">3</span> <span class="keyword">where</span> c1=<span class="number">1</span> <span class="keyword">and</span> c2=<span class="number">1</span>;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> t1 <span class="keyword">set</span> c1=<span class="number">4</span> <span class="keyword">where</span> c1=<span class="number">2</span> <span class="keyword">and</span> c2=<span class="number">2</span>;</span><br><span class="line">ERROR 1205 (HY000): <span class="keyword">Lock</span> <span class="keyword">wait</span> <span class="keyword">timeout</span> exceeded; try restarting transaction</span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t1;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| c1   | c2   |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    1 |    1 |</span><br><span class="line">|    1 |    2 |</span><br><span class="line">|    2 |    1 |</span><br><span class="line">|    2 |    2 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<h3 id="delete备库回放"><a href="#delete备库回放" class="headerlink" title="delete备库回放"></a>delete备库回放</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show create table test_no_primary;</span><br><span class="line">+-----------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Table           | Create Table                                                                                                                                          |</span><br><span class="line">+-----------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| test_no_primary | CREATE TABLE &#96;test_no_primary&#96; (</span><br><span class="line">  &#96;c1&#96; int(11) DEFAULT NULL,</span><br><span class="line">  &#96;c2&#96; varchar(20) DEFAULT NULL,</span><br><span class="line">  KEY &#96;i1&#96; (&#96;c1&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 |</span><br><span class="line">+-----------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_no_primary;</span><br><span class="line">+------+------+</span><br><span class="line">| c1   | c2   |</span><br><span class="line">+------+------+</span><br><span class="line">|    1 | a    |</span><br><span class="line">|    1 | b    |</span><br><span class="line">|    1 | c    |</span><br><span class="line">+------+------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; delete from test_no_primary where c1&#x3D;1;</span><br><span class="line">Query OK, 3 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 主库-&gt;备库日志</span><br><span class="line">#201023 21:44:30 server id 2454784635  end_log_pos 5657 CRC32 0x7b63ea86  Delete_rows: table id 282 flags: STMT_END_F</span><br><span class="line">### DELETE FROM &#96;test&#96;.&#96;test_no_primary&#96;</span><br><span class="line">### WHERE</span><br><span class="line">###   @1&#x3D;1 &#x2F;* INT meta&#x3D;0 nullable&#x3D;1 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @2&#x3D;&#39;a&#39; &#x2F;* VARSTRING(60) meta&#x3D;60 nullable&#x3D;1 is_null&#x3D;0 *&#x2F;</span><br><span class="line">### DELETE FROM &#96;test&#96;.&#96;test_no_primary&#96;</span><br><span class="line">### WHERE</span><br><span class="line">###   @1&#x3D;1 &#x2F;* INT meta&#x3D;0 nullable&#x3D;1 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @2&#x3D;&#39;b&#39; &#x2F;* VARSTRING(60) meta&#x3D;60 nullable&#x3D;1 is_null&#x3D;0 *&#x2F;</span><br><span class="line">### DELETE FROM &#96;test&#96;.&#96;test_no_primary&#96;</span><br><span class="line">### WHERE</span><br><span class="line">###   @1&#x3D;1 &#x2F;* INT meta&#x3D;0 nullable&#x3D;1 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @2&#x3D;&#39;c&#39; &#x2F;* VARSTRING(60) meta&#x3D;60 nullable&#x3D;1 is_null&#x3D;0 *&#x2F;</span><br><span class="line"># at 5657</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; show create table test_with_primary;</span><br><span class="line">+-------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Table             | Create Table                                                                                                                                                                                                                            |</span><br><span class="line">+-------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| test_with_primary | CREATE TABLE &#96;test_with_primary&#96; (</span><br><span class="line">  &#96;c0&#96; int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;c1&#96; int(11) DEFAULT NULL,</span><br><span class="line">  &#96;c2&#96; varchar(20) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;c0&#96;),</span><br><span class="line">  KEY &#96;i1&#96; (&#96;c1&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;31 DEFAULT CHARSET&#x3D;utf8 |</span><br><span class="line">+-------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_with_primary;</span><br><span class="line">+----+------+------+</span><br><span class="line">| c0 | c1   | c2   |</span><br><span class="line">+----+------+------+</span><br><span class="line">|  1 |    1 | a    |</span><br><span class="line">| 11 |    1 | b    |</span><br><span class="line">| 21 |    1 | c    |</span><br><span class="line">+----+------+------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; delete from test_with_primary where c1&#x3D;1;</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 主库-&gt;备库日志</span><br><span class="line">#201023 21:53:59 server id 2454784635  end_log_pos 7005 CRC32 0xc0c83f05  Delete_rows: table id 284 flags: STMT_END_F</span><br><span class="line">### DELETE FROM &#96;test&#96;.&#96;test_with_primary&#96;</span><br><span class="line">### WHERE</span><br><span class="line">###   @1&#x3D;1 &#x2F;* INT meta&#x3D;0 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @2&#x3D;1 &#x2F;* INT meta&#x3D;0 nullable&#x3D;1 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @3&#x3D;&#39;a&#39; &#x2F;* VARSTRING(60) meta&#x3D;60 nullable&#x3D;1 is_null&#x3D;0 *&#x2F;</span><br><span class="line">### DELETE FROM &#96;test&#96;.&#96;test_with_primary&#96;</span><br><span class="line">### WHERE</span><br><span class="line">###   @1&#x3D;11 &#x2F;* INT meta&#x3D;0 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @2&#x3D;1 &#x2F;* INT meta&#x3D;0 nullable&#x3D;1 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @3&#x3D;&#39;b&#39; &#x2F;* VARSTRING(60) meta&#x3D;60 nullable&#x3D;1 is_null&#x3D;0 *&#x2F;</span><br><span class="line">### DELETE FROM &#96;test&#96;.&#96;test_with_primary&#96;</span><br><span class="line">### WHERE</span><br><span class="line">###   @1&#x3D;21 &#x2F;* INT meta&#x3D;0 nullable&#x3D;0 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @2&#x3D;1 &#x2F;* INT meta&#x3D;0 nullable&#x3D;1 is_null&#x3D;0 *&#x2F;</span><br><span class="line">###   @3&#x3D;&#39;c&#39; &#x2F;* VARSTRING(60) meta&#x3D;60 nullable&#x3D;1 is_null&#x3D;0 *&#x2F;</span><br><span class="line"># at 7005</span><br></pre></td></tr></table></figure>

<h3 id="uuid-gt-auto-increment"><a href="#uuid-gt-auto-increment" class="headerlink" title="uuid -&gt; auto_increment"></a>uuid -&gt; auto_increment</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from test;</span><br><span class="line">+--------------------------------------+------+</span><br><span class="line">| c1                                   | c2   |</span><br><span class="line">+--------------------------------------+------+</span><br><span class="line">| 17f6ea4e-1ea8-11eb-95f7-b54d65122ba1 | aaa  |</span><br><span class="line">| 1ab073fe-1ea8-11eb-95f7-b54d65122ba1 | bbb  |</span><br><span class="line">| 1c2a32d8-1ea8-11eb-95f7-b54d65122ba1 | ccc  |</span><br><span class="line">+--------------------------------------+------+</span><br><span class="line"></span><br><span class="line">mysql&gt; desc test;</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type        | Null | Key | Default | Extra |</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line">| c1    | varchar(36) | NO   | PRI | NULL    |       |</span><br><span class="line">| c2    | varchar(20) | YES  |     | NULL    |       |</span><br><span class="line">+-------+-------------+------+-----+---------+-------+</span><br><span class="line"></span><br><span class="line">mysql&gt; alter table test drop primary key;</span><br><span class="line">mysql&gt; alter table test add column c3 int auto_increment primary key;</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test;</span><br><span class="line">+--------------------------------------+------+----+</span><br><span class="line">| c1                                   | c2   | c3 |</span><br><span class="line">+--------------------------------------+------+----+</span><br><span class="line">| 17f6ea4e-1ea8-11eb-95f7-b54d65122ba1 | aaa  |  1 |</span><br><span class="line">| 1ab073fe-1ea8-11eb-95f7-b54d65122ba1 | bbb  |  2 |</span><br><span class="line">| 1c2a32d8-1ea8-11eb-95f7-b54d65122ba1 | ccc  |  3 |</span><br><span class="line">+--------------------------------------+------+----+</span><br></pre></td></tr></table></figure>

<h3 id="字符串索引数字查询"><a href="#字符串索引数字查询" class="headerlink" title="字符串索引数字查询"></a>字符串索引数字查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show create table test\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: test</span><br><span class="line">Create Table: CREATE TABLE &#96;test&#96; (</span><br><span class="line">  &#96;c1&#96; int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;c2&#96; varchar(20) DEFAULT NULL,</span><br><span class="line">  &#96;c3&#96; char(36) DEFAULT NULL,</span><br><span class="line">  &#96;c4&#96; char(36) DEFAULT NULL,</span><br><span class="line">  &#96;c5&#96; char(36) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;c1&#96;),</span><br><span class="line">  KEY &#96;i1&#96; (&#96;c2&#96;),</span><br><span class="line">  KEY &#96;i2&#96; (&#96;c2&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;1376221 DEFAULT CHARSET&#x3D;utf8</span><br><span class="line">1 row in set (0.05 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; explain select * from test where c2&#x3D;&#39;1&#39;;</span><br><span class="line">+----+-------------+-------+------------+------+---------------+------+---------+-------+------+----------+-------+</span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref   | rows | filtered | Extra |</span><br><span class="line">+----+-------------+-------+------------+------+---------------+------+---------+-------+------+----------+-------+</span><br><span class="line">|  1 | SIMPLE      | test  | NULL       | ref  | i1,i2         | i1   | 63      | const |    1 |   100.00 | NULL  |</span><br><span class="line">+----+-------------+-------+------------+------+---------------+------+---------+-------+------+----------+-------+</span><br><span class="line"></span><br><span class="line">mysql&gt; explain select * from test where c2&#x3D;1;</span><br><span class="line">+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------------+</span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows    | filtered | Extra       |</span><br><span class="line">+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------------+</span><br><span class="line">|  1 | SIMPLE      | test  | NULL       | ALL  | i1,i2         | NULL | NULL    | NULL | 1044395 |    10.00 | Using where |</span><br><span class="line">+----+-------------+-------+------------+------+---------------+------+---------+------+---------+----------+-------------+</span><br></pre></td></tr></table></figure>

<p>官方解释：<br>For comparisons of a string column with a number, MySQL cannot use an index on the column to look up the value quickly. If str_col is an indexed string column, the index cannot be used when performing the lookup in the following statement</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM tbl_name WHERE str_col&#x3D;1;</span><br></pre></td></tr></table></figure>

<p>The reason for this is that there are many different strings that may convert to the value 1, such as ‘1’, ‘ 1’, or ‘1a’.</p>
<h3 id="ibtmp1-临时表空间"><a href="#ibtmp1-临时表空间" class="headerlink" title="ibtmp1 临时表空间"></a>ibtmp1 临时表空间</h3><p>explain为Using temporary的使用ibtmp1，无法自动释放</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT @@innodb_temp_data_file_path;</span><br><span class="line">+------------------------------+</span><br><span class="line">| @@innodb_temp_data_file_path |</span><br><span class="line">+------------------------------+</span><br><span class="line">| ibtmp1:12M:autoextend        |</span><br><span class="line">+------------------------------+</span><br><span class="line"></span><br><span class="line">mysql&gt; explain insert into test_tmp(c2) select c2 from test_tmp;</span><br><span class="line">+----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-----------------+</span><br><span class="line">| id | select_type | table    | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra           |</span><br><span class="line">+----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-----------------+</span><br><span class="line">|  1 | INSERT      | test_tmp | NULL       | ALL  | NULL          | NULL | NULL    | NULL | NULL |     NULL | NULL            |</span><br><span class="line">|  1 | SIMPLE      | test_tmp | NULL       | ALL  | NULL          | NULL | NULL    | NULL |    2 |   100.00 | Using temporary |</span><br><span class="line">+----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-----------------+</span><br><span class="line"></span><br><span class="line">$ du -sh &#x2F;usr&#x2F;local&#x2F;var&#x2F;mysql&#x2F;test&#x2F;test_tmp.ibd </span><br><span class="line">513M	&#x2F;usr&#x2F;local&#x2F;var&#x2F;mysql&#x2F;test&#x2F;test_tmp.ibd</span><br><span class="line">$ du -sh &#x2F;usr&#x2F;local&#x2F;var&#x2F;mysql&#x2F;ibtmp1 </span><br><span class="line">273M	&#x2F;usr&#x2F;local&#x2F;var&#x2F;mysql&#x2F;ibtmp1</span><br></pre></td></tr></table></figure>

<h2 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h2><h3 id=""><a href="#" class="headerlink" title=""></a><a href="https://redis.io/topics/notifications" title="" target="">Notifications</a></h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; config set notify-keyspace-events KEA</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; psubscribe '*'</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) "psubscribe"</span><br><span class="line">2) "*"</span><br><span class="line">3) (integer) 1</span><br><span class="line"></span><br><span class="line">1) "pmessage"</span><br><span class="line">2) "*"</span><br><span class="line">3) "__keyspace@0__:foo"</span><br><span class="line">4) "set"</span><br><span class="line">1) "pmessage"</span><br><span class="line">2) "*"</span><br><span class="line">3) "__keyevent@0__:set"</span><br><span class="line">4) "foo"</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set foo 1</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>




    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%B5%8B%E8%AF%95/" rel="tag"># 测试</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/04/29/go/goim/" rel="prev" title="goim源码">
      <i class="fa fa-chevron-left"></i> goim源码
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/05/04/go/modules/" rel="next" title="go module">
      go module <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#mysql"><span class="nav-number">1.</span> <span class="nav-text">mysql</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#版本5-7"><span class="nav-number">1.1.</span> <span class="nav-text">版本5.7</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#范围查询包含非key字段"><span class="nav-number">1.2.</span> <span class="nav-text">范围查询包含非key字段</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1个字符，4000W"><span class="nav-number">1.2.1.</span> <span class="nav-text">1个字符，4000W</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#90-范围查询，带text字段，不走索引"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">90%范围查询，带text字段，不走索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#10-范围查询，带text字段，不走索引"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">10%范围查询，带text字段，不走索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#树高度"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">树高度</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5个字符，4000W"><span class="nav-number">1.2.2.</span> <span class="nav-text">5个字符，4000W</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#90-范围查询，带text字段，不走索引-1"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">90%范围查询，带text字段，不走索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#10-范围查询，带text字段，不走索引-1"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">10%范围查询，带text字段，不走索引</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#200个字符，4000W"><span class="nav-number">1.2.3.</span> <span class="nav-text">200个字符，4000W</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#90-范围查询，带text字段，不走索引-2"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">90%范围查询，带text字段，不走索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#90-范围查询，仅查询索引字段或count-计数，走索引"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">90%范围查询，仅查询索引字段或count(*)计数，走索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#10-范围查询，带text字段，不走索引-2"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">10%范围查询，带text字段，不走索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#主键查询固定走索引"><span class="nav-number">1.2.3.4.</span> <span class="nav-text">主键查询固定走索引</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#200个字符，1W"><span class="nav-number">1.2.4.</span> <span class="nav-text">200个字符，1W</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#90-范围查询，带text字段，不走索引-3"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">90%范围查询，带text字段，不走索引</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#10-范围查询，带text字段，走索引"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">10%范围查询，带text字段，走索引</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#200个字符，4000W，耗时比较"><span class="nav-number">1.2.5.</span> <span class="nav-text">200个字符，4000W，耗时比较</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#语句"><span class="nav-number">1.2.6.</span> <span class="nav-text">语句</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#autoincrement-uuid-insert速度比较"><span class="nav-number">1.3.</span> <span class="nav-text">autoincrement &#x2F; uuid  insert速度比较</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#view"><span class="nav-number">1.4.</span> <span class="nav-text">view</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#语句-1"><span class="nav-number">1.4.1.</span> <span class="nav-text">语句</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#binlog-row-image"><span class="nav-number">1.5.</span> <span class="nav-text">binlog_row_image</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#create-table"><span class="nav-number">1.5.1.</span> <span class="nav-text">create table</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#full"><span class="nav-number">1.5.2.</span> <span class="nav-text">full</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#minimal"><span class="nav-number">1.5.3.</span> <span class="nav-text">minimal</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用备份idb快速恢复历史数据"><span class="nav-number">1.6.</span> <span class="nav-text">使用备份idb快速恢复历史数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#锁等待"><span class="nav-number">1.7.</span> <span class="nav-text">锁等待</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#partition"><span class="nav-number">1.8.</span> <span class="nav-text">partition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#partition快速删除分区数据"><span class="nav-number">1.9.</span> <span class="nav-text">partition快速删除分区数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MRR"><span class="nav-number">1.10.</span> <span class="nav-text">MRR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自增变量未持久化"><span class="nav-number">1.11.</span> <span class="nav-text">自增变量未持久化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DDL非原子"><span class="nav-number">1.12.</span> <span class="nav-text">DDL非原子</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建降序索引仍为升序"><span class="nav-number">1.13.</span> <span class="nav-text">创建降序索引仍为升序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#innodb-rollback-on-timeout"><span class="nav-number">1.14.</span> <span class="nav-text">innodb_rollback_on_timeout</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#delete备库回放"><span class="nav-number">1.15.</span> <span class="nav-text">delete备库回放</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#uuid-gt-auto-increment"><span class="nav-number">1.16.</span> <span class="nav-text">uuid -&gt; auto_increment</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串索引数字查询"><span class="nav-number">1.17.</span> <span class="nav-text">字符串索引数字查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ibtmp1-临时表空间"><span class="nav-number">1.18.</span> <span class="nav-text">ibtmp1 临时表空间</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#redis"><span class="nav-number">2.</span> <span class="nav-text">redis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#"><span class="nav-number">2.1.</span> <span class="nav-text">Notifications</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">yiduoyunQ</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">31</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yiduoyunQ</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
