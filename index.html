<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yiduoyunq.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="yiduoyunQ">
<meta property="og:url" content="https://yiduoyunq.github.io/index.html">
<meta property="og:site_name" content="yiduoyunQ">
<meta property="article:author" content="yiduoyunQ">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://yiduoyunq.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>yiduoyunQ</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">yiduoyunQ</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://yiduoyunq.github.io/2021/01/30/yuque/Tidb%20parser/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yiduoyunQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yiduoyunQ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/30/yuque/Tidb%20parser/" class="post-title-link" itemprop="url">Tidb parser</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-01-30 16:52:47 / Modified: 18:19:56" itemprop="dateCreated datePublished" datetime="2021-01-30T16:52:47+00:00">2021-01-30</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Import-Dependencies"><a href="#Import-Dependencies" class="headerlink" title="Import Dependencies"></a>Import Dependencies</h2><blockquote>
<p>go get -v github.com/pingcap/tidb/types/parser_driver@328b6d0</p>
</blockquote>
<p>test111</p>
<h2 id="test"><a href="#test" class="headerlink" title="test"></a>test</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"github.com/pingcap/parser"</span></span><br><span class="line">	<span class="string">"github.com/pingcap/parser/ast"</span></span><br><span class="line">	_ <span class="string">"github.com/pingcap/tidb/types/parser_driver"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> colX <span class="keyword">struct</span> &#123;</span><br><span class="line">	colNames []<span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *colX)</span> <span class="title">Enter</span><span class="params">(in ast.Node)</span> <span class="params">(ast.Node, <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> name, ok := in.(*ast.ColumnName); ok &#123;</span><br><span class="line">		v.colNames = <span class="built_in">append</span>(v.colNames, name.Name.O)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> in, <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *colX)</span> <span class="title">Leave</span><span class="params">(in ast.Node)</span> <span class="params">(ast.Node, <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> in, <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">extractColumnName</span><span class="params">(rootNode *ast.StmtNode)</span> []<span class="title">string</span></span> &#123;</span><br><span class="line">	v := &amp;colX&#123;&#125;</span><br><span class="line">	(*rootNode).Accept(v)</span><br><span class="line">	<span class="keyword">return</span> v.colNames</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">parse</span><span class="params">(sql <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	p := parser.New()</span><br><span class="line"></span><br><span class="line">	stmtNodes, _, err := p.Parse(sql, <span class="string">""</span>, <span class="string">""</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">"parse error: %v\n"</span>, err.Error())</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">"%v\n"</span>, extractColumnName(&amp;stmtNodes[<span class="number">0</span>]))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">normalize</span><span class="params">(sql <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">"%v\n"</span>, parser.Normalize(sql))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	sql := <span class="string">`SELECT a, b from t where c1=1 and c2='a' and c3='2021/01/30 0:00:00'`</span></span><br><span class="line">	parse(sql)     <span class="comment">// a b c1 c2 c3 c c4</span></span><br><span class="line">	normalize(sql) <span class="comment">// select a , b from t where c1 = ? and c2 = ? and c3 = ?</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h2><p><a href="https://github.com/pingcap/parser/blob/master/docs/quickstart.md" target="_blank" rel="noopener">pingcap/parser/docs/quickstart.md</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://yiduoyunq.github.io/2021/01/25/go/reflect/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yiduoyunQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yiduoyunQ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/25/go/reflect/" class="post-title-link" itemprop="url">反射</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-25 22:50:23" itemprop="dateCreated datePublished" datetime="2021-01-25T22:50:23+00:00">2021-01-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-30 18:19:35" itemprop="dateModified" datetime="2021-01-30T18:19:35+00:00">2021-01-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="byte到string转换需要拷贝内存"><a href="#byte到string转换需要拷贝内存" class="headerlink" title="[]byte到string转换需要拷贝内存"></a>[]byte到string转换需要拷贝内存</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">b := []<span class="keyword">byte</span>(<span class="string">"b"</span>)</span><br><span class="line">s := <span class="keyword">string</span>(b)</span><br><span class="line">pbyte := (*reflect.SliceHeader)(unsafe.Pointer(&amp;b)</span><br><span class="line">pstring := (*reflect.StringHeader)(unsafe.Pointer(&amp;s))</span><br><span class="line">fmt.Println(pbyte.Data == pstring.Data) <span class="comment">// false</span></span><br><span class="line">b = []<span class="keyword">byte</span>(<span class="string">"ttt"</span>)</span><br><span class="line">pstring.Data = pbyte.Data</span><br><span class="line">fmt.Println(s) <span class="comment">// t</span></span><br><span class="line">pstring.Len = pbyte.Len</span><br><span class="line">fmt.Println(s) <span class="comment">// ttt</span></span><br><span class="line">ss := <span class="keyword">string</span>(s)</span><br><span class="line">psstring := (*reflect.StringHeader)(unsafe.Pointer(&amp;ss))</span><br><span class="line">   fmt.Println(psstring.Data == pbyte.Data) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://yiduoyunq.github.io/2020/11/23/go/net/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yiduoyunQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yiduoyunQ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/23/go/net/" class="post-title-link" itemprop="url">net poll</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-23 22:53:19" itemprop="dateCreated datePublished" datetime="2020-11-23T22:53:19+00:00">2020-11-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-30 18:19:35" itemprop="dateModified" datetime="2021-01-30T18:19:35+00:00">2021-01-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="select-poll-epoll"><a href="#select-poll-epoll" class="headerlink" title="select / poll / epoll"></a>select / poll / epoll</h2><img src="/2020/11/23/go/net/select_poll_epoll.png" class="">

<h2 id="net-Listen"><a href="#net-Listen" class="headerlink" title="net.Listen"></a>net.Listen</h2><img src="/2020/11/23/go/net/net_Listen.jpeg" class="">

<ol>
<li><code>net.Listen</code>通过 <code>netFD.init</code> -&gt; <code>FD.Init</code> -&gt; <code>pollDesc.init</code> -&gt; 最终调用 <code>epollcreate1</code> 创建全局唯一 <strong>epfd</strong>，然后调用 <code>epollctl</code> 将 <strong>listener fd</strong>注册到epoll实例的事件队列</li>
<li>通过 <code>var serverInit sync.Once</code> 保证epollcreate1只在Listen时执行一次，后续Accept调用复用 <code>FD.Init</code> 时不会执行</li>
</ol>
<h2 id="net-Accept"><a href="#net-Accept" class="headerlink" title="net.Accept"></a>net.Accept</h2><img src="/2020/11/23/go/net/net_Accept.jpeg" class="">

<ol>
<li><code>pollDesc.waitRead</code> 循环检测上层netFD的FD是否有 <strong>pdReady</strong> I/O事件，如果有I/O发生则返回，否则park当前goroutine直到对应FD可读或可写后返回。</li>
<li><code>FD.Accept</code> 返回后，调用 <code>newFD</code> 创建这个新的socket对应的 <strong>netFD</strong>， 然后调用 <code>netFD.init</code> 完成初始化，调用链同Listen，最终将 <strong>socket fd</strong> 注册到 <strong>listener fd</strong> 的epoll实例的事件队列中</li>
<li>被park的goroutine在 <code>func netpoll(delay int64) gList</code> 中调用 <code>epollwait</code> 处理可读/可写的事件fd，生成g链表返回。 <code>netpoll</code> 函数在proc的GPM逻辑中被调用</li>
</ol>
<h2 id="Conn-Read-Conn-Write"><a href="#Conn-Read-Conn-Write" class="headerlink" title="Conn.Read/Conn.Write"></a>Conn.Read/Conn.Write</h2><h2 id="net-flow"><a href="#net-flow" class="headerlink" title="net flow"></a>net flow</h2><ul>
<li>Listen创建epoll实例</li>
<li>client连接server，Listener调用Accept接收conn，每个conn开启一个goroutine处理，所有信息注册到epoll实例的事件队列</li>
<li>conn调用Read/Write时被park当前goroutine，在GPM逻辑中调用netpoll唤醒goroutine响应I/O事件</li>
</ul>
<p>epoll本质为系统内核顺序I/O，通过结合goroutine的GPM框架，解耦内核I/O和用户I/O，达到高并发I/O的设计</p>
<h2 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h2><p><a href="https://zhuanlan.zhihu.com/p/299047984" target="_blank" rel="noopener">Go netpoller 网络模型之源码全面解析</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://yiduoyunq.github.io/2020/11/18/k8s/cgroup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yiduoyunQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yiduoyunQ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/18/k8s/cgroup/" class="post-title-link" itemprop="url">cgroup</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-18 15:00:34" itemprop="dateCreated datePublished" datetime="2020-11-18T15:00:34+00:00">2020-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-30 18:19:36" itemprop="dateModified" datetime="2021-01-30T18:19:36+00:00">2021-01-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="V1"><a href="#V1" class="headerlink" title="V1"></a>V1</h2><img src="/2020/11/18/k8s/cgroup/cgroupV1.jpg" class="">

<h2 id="V2"><a href="#V2" class="headerlink" title="V2"></a>V2</h2><img src="/2020/11/18/k8s/cgroup/cgroupV2.jpg" class="">

<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ls /sys/fs/cgroup/ |grep cpu</span></span><br><span class="line">cpu</span><br><span class="line">cpuacct</span><br><span class="line">cpu,cpuacct</span><br><span class="line">cpuset</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> cat /sys/fs/cgroup/cpu/user.slice/tasks</span></span><br><span class="line">4872</span><br><span class="line">21893</span><br><span class="line">21896</span><br><span class="line">21907</span><br><span class="line">21913</span><br><span class="line">21914</span><br><span class="line"><span class="meta">#</span><span class="bash"> ps -ef | grep 21896 | grep -v grep</span></span><br><span class="line">root     21896     1  0 14:15 ?        00:00:00 /usr/lib/systemd/systemd --user</span><br><span class="line">root     21907 21896  0 14:15 ?        00:00:00 (sd-pam)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>tasks中记录cgroup内pid</p>
</blockquote>
<h2 id="cgroup-amp-namespace-amp-unionFS"><a href="#cgroup-amp-namespace-amp-unionFS" class="headerlink" title="cgroup &amp; namespace &amp; unionFS"></a>cgroup &amp; namespace &amp; unionFS</h2><ol>
<li>cgroup用于隔离物理资源： cpu，mem等</li>
<li>namespace用于隔离pid间资源：<br> pid namespace用于模拟容器内root用户<br> mount namespace用于模拟容器内所属目录</li>
<li>unionFS用于分层搭建容器FS，参见overlay2</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://yiduoyunq.github.io/2020/11/18/go/wgb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yiduoyunQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yiduoyunQ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/18/go/wgb/" class="post-title-link" itemprop="url">三色标记清除法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-18 12:37:20" itemprop="dateCreated datePublished" datetime="2020-11-18T12:37:20+00:00">2020-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-30 18:19:36" itemprop="dateModified" datetime="2021-01-30T18:19:36+00:00">2021-01-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index"><span itemprop="name">go</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="原始标记清除法"><a href="#原始标记清除法" class="headerlink" title="原始标记清除法"></a>原始标记清除法</h2><img src="/2020/11/18/go/wgb/mark_and_sweep.jpg" class="">

<ol>
<li>从root开始循环遍历对象，mark</li>
<li>对未mark对象，sweep</li>
</ol>
<h2 id="三色标记清除法"><a href="#三色标记清除法" class="headerlink" title="三色标记清除法"></a>三色标记清除法</h2><blockquote>
<p>白： 未标记，本次GC被sweep对象<br>灰： 待标记，最终转黑<br>黑： 标记，本次GC保留对象</p>
</blockquote>
<h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><ol>
<li>初始所有对象为<strong><em>白</em></strong></li>
<li>从root开始遍历一次对象，标记为<strong><em>灰</em></strong></li>
<li>遍历一次<strong><em>灰</em></strong>，标记本对象为<strong><em>黑</em></strong>，标记引用对象为<strong><em>灰</em></strong>，重复本操作</li>
<li>剩余<strong><em>白</em></strong>即为待sweep对象</li>
</ol>
<h3 id="若不使用STW的问题"><a href="#若不使用STW的问题" class="headerlink" title="若不使用STW的问题"></a>若不使用STW的问题</h3><ol>
<li>白的(灰)引用被破坏</li>
<li>白被黑引用</li>
</ol>
<blockquote>
<p>满足以上2个条件，产生错误sweep</p>
</blockquote>
<h3 id="强三色不变式"><a href="#强三色不变式" class="headerlink" title="强三色不变式"></a>强三色不变式</h3><p>不允许白被黑引用</p>
<h3 id="若三色不变式"><a href="#若三色不变式" class="headerlink" title="若三色不变式"></a>若三色不变式</h3><p>允许白被黑引用的前提：白的上游链路存在灰</p>
<h3 id="插入写屏障"><a href="#插入写屏障" class="headerlink" title="插入写屏障"></a>插入写屏障</h3><blockquote>
<p>对象被引用时触发<br>满足强三色不变式</p>
</blockquote>
<p>对象被引用时，设为<strong><em>灰</em></strong></p>
<h4 id="插入写屏障问题"><a href="#插入写屏障问题" class="headerlink" title="插入写屏障问题"></a>插入写屏障问题</h4><p>为提高GC效率，<font color=red>栈内存</font>不执行插入写屏障</p>
<p>解决：</p>
<ol>
<li>三色标记完成后，栈对象统一变<strong><em>白</em></strong></li>
<li>启动STW</li>
<li>三色标记处理栈对象</li>
<li>停止STW</li>
</ol>
<blockquote>
<p>STW扫描栈对象耗时10-100ms</p>
</blockquote>
<h3 id="删除屏障"><a href="#删除屏障" class="headerlink" title="删除屏障"></a>删除屏障</h3><blockquote>
<p>对象被删除时触发<br>满足弱三色不变式</p>
</blockquote>
<p>标记下游引用对象为<strong><em>灰</em></strong></p>
<h4 id="删除屏障问题"><a href="#删除屏障问题" class="headerlink" title="删除屏障问题"></a>删除屏障问题</h4><p>删除对象下游对象最终会被标记为<strong><em>黑</em></strong>，可能无其他引用，本轮GC保留一轮，在下轮GC清除</p>
<h3 id="混合写屏障-结合写屏障和删除屏障"><a href="#混合写屏障-结合写屏障和删除屏障" class="headerlink" title="混合写屏障 (结合写屏障和删除屏障)"></a>混合写屏障 (结合写屏障和删除屏障)</h3><ol>
<li>初始扫描<font color=red>栈可达对象</font>标记为<strong><em>黑</em></strong>，GC期间新创建的栈对象直接标记为<strong><em>黑</em></strong> (解决写屏障问题)</li>
<li>被删除对象为<strong><em>灰</em></strong> (删除屏障)</li>
<li>被添加对象为<strong><em>灰</em></strong> (写屏障)</li>
</ol>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://yiduoyunq.github.io/2020/10/22/k8s/overlay2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yiduoyunQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yiduoyunQ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/22/k8s/overlay2/" class="post-title-link" itemprop="url">overlay2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-22 22:35:45" itemprop="dateCreated datePublished" datetime="2020-10-22T22:35:45+00:00">2020-10-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-30 18:19:36" itemprop="dateModified" datetime="2021-01-30T18:19:36+00:00">2021-01-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <img src="/2020/10/22/k8s/overlay2/unionFS.png" class="">

<blockquote>
<p>所有image层之上是<font color=red>容器层</font>，容器内修改操作仅发生在容器层<br>可通过docker外挂方式将物理机目录挂在进容器</p>
</blockquote>
<pre><code class="shell"><span class="meta">#</span><span class="bash"> docker info | grep -E <span class="string">"Storage Driver|Root"</span></span>
 Storage Driver: overlay2
 Docker Root Dir: /var/lib/docker

<span class="meta">#</span><span class="bash"> <span class="built_in">pwd</span></span>
/var/lib/docker/image
<span class="meta">#</span><span class="bash"> ll</span>
总用量 0
drwx------ 5 root root 81 6月  30 23:40 overlay2

<span class="meta">#</span><span class="bash"> docker images | grep nginx |grep 1.9.1</span>
nginx                                                             1.9.1               94ec7e53edfc        5 years ago         133MB
<span class="meta">#</span><span class="bash"> <span class="built_in">pwd</span></span>
/var/lib/docker/image/overlay2/imagedb/content/sha256
<span class="meta">#</span><span class="bash"> ll |grep 94ec7e53edfc</span>
-rw------- 1 root root 4520 6月  21 22:39 94ec7e53edfc793d6d8412b4748cd84270da290ce9256730eb428574f98f7c95
<span class="meta">#</span><span class="bash"> cat 94ec7e53edfc793d6d8412b4748cd84270da290ce9256730eb428574f98f7c95 | jq . |grep -A 20 rootfs</span>
  "rootfs": {
    "type": "layers",
    "diff_ids": [
      "sha256:d55f823e63e3bd76ed8a77582f6701fe86bbceb674e953fc218df06d10f99da5",
      "sha256:5f70bf18a086007016e948b04aed3b82103a36bea41755b6cddfaf10ace3c6ef",
      "sha256:5f70bf18a086007016e948b04aed3b82103a36bea41755b6cddfaf10ace3c6ef",
      ......
    ]
  }
}

<span class="meta">#</span><span class="bash"> <span class="built_in">pwd</span></span>
/var/lib/docker/image/overlay2/layerdb/sha256

<span class="meta">#</span><span class="bash"> layer1 = diff_ids[0]</span>
<span class="meta">#</span><span class="bash"> ll |grep d55f823e63e3bd76ed8a77582f6701fe86bbceb674e953fc218df06d10f99da5</span>
drwx------ 2 root root 71 6月  21 22:39 d55f823e63e3bd76ed8a77582f6701fe86bbceb674e953fc218df06d10f99da5

<span class="meta">#</span><span class="bash"> layer2 = layer1 + diff_ids[1]</span>
<span class="meta">#</span><span class="bash"> <span class="built_in">echo</span> -n <span class="string">"sha256:d55f823e63e3bd76ed8a77582f6701fe86bbceb674e953fc218df06d10f99da5 sha256:5f70bf18a086007016e948b04aed3b82103a36bea41755b6cddfaf10ace3c6ef"</span> | sha256sum</span>
c79ce3b23816801c1c2f5a1eebd4e70b513c971670053bd0269689cb6c4c7843  -
<span class="meta">#</span><span class="bash"> ll |grep c79ce3b23816801c1c2f5a1eebd4e70b513c971670053bd0269689cb6c4c7843</span>
drwx------ 2 root root 85 6月  21 22:39 c79ce3b23816801c1c2f5a1eebd4e70b513c971670053bd0269689cb6c4c7843

<span class="meta">#</span><span class="bash"> layer3 = layer2 + diff_ids[2]</span>
<span class="meta">#</span><span class="bash"> <span class="built_in">echo</span> -n <span class="string">"sha256:c79ce3b23816801c1c2f5a1eebd4e70b513c971670053bd0269689cb6c4c7843 sha256:5f70bf18a086007016e948b04aed3b82103a36bea41755b6cddfaf10ace3c6ef"</span> | sha256sum</span>
8f5776356fae028caf803b96e16158934f12612836f99e273eab24c60465d5b8  -
<span class="meta">#</span><span class="bash"> ll |grep 8f5776356fae028caf803b96e16158934f12612836f99e273eab24c60465d5b8</span>
drwx------ 2 root root 85 6月  21 22:39 8f5776356fae028caf803b96e16158934f12612836f99e273eab24c60465d5b8

<span class="meta">#</span><span class="bash"> layer -&gt; rootfs cache-id</span>
<span class="meta">#</span><span class="bash"> cat 8f5776356fae028caf803b96e16158934f12612836f99e273eab24c60465d5b8/cache-id</span>
86ee0049958014c13786026f642b9874a679f9c32ec12bfb5f7101747e43ec1e
<span class="meta">#</span><span class="bash"> <span class="built_in">pwd</span></span>
/var/lib/docker/overlay2
<span class="meta">#</span><span class="bash"> ll | grep 86ee0049958014c13786026f642b9874a679f9c32ec12bfb5f7101747e43ec1e</span>
drwx------ 4 root root     72 6月  21 22:39 86ee0049958014c13786026f642b9874a679f9c32ec12bfb5f7101747e43ec1e</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://yiduoyunq.github.io/2020/10/14/mysql/latch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yiduoyunQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yiduoyunQ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/14/mysql/latch/" class="post-title-link" itemprop="url">innodb btree latch</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-14 22:38:45" itemprop="dateCreated datePublished" datetime="2020-10-14T22:38:45+00:00">2020-10-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-30 18:19:36" itemprop="dateModified" datetime="2021-01-30T18:19:36+00:00">2021-01-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="mysql5-6-modify-leaf"><a href="#mysql5-6-modify-leaf" class="headerlink" title="mysql5.6 modify leaf"></a>mysql5.6 modify leaf</h2><img src="/2020/10/14/mysql/latch/5.6modifyleaf.jpg" class="">

<h2 id="mysql5-6-modify-tree"><a href="#mysql5-6-modify-tree" class="headerlink" title="mysql5.6 modify tree"></a>mysql5.6 modify tree</h2><img src="/2020/10/14/mysql/latch/5.6modifytree.jpg" class="">

<h2 id="mysql5-7-select-amp-modify-leaf"><a href="#mysql5-7-select-amp-modify-leaf" class="headerlink" title="mysql5.7 select &amp; modify leaf"></a>mysql5.7 select &amp; modify leaf</h2><img src="/2020/10/14/mysql/latch/5.7select_modifyleaf.jpg" class="">

<h2 id="mysql5-7-modify-tree"><a href="#mysql5-7-modify-tree" class="headerlink" title="mysql5.7 modify tree"></a>mysql5.7 modify tree</h2><img src="/2020/10/14/mysql/latch/5.7modifytree.jpg" class="">

<h2 id="5-6-gt-5-7"><a href="#5-6-gt-5-7" class="headerlink" title="5.6 -&gt; 5.7"></a>5.6 -&gt; 5.7</h2><ul>
<li>引入sx lock</li>
<li>引入non-leaf page lock</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://yiduoyunq.github.io/2020/07/31/mysql/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yiduoyunQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yiduoyunQ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/31/mysql/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">分布式学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-07-31 00:59:32" itemprop="dateCreated datePublished" datetime="2020-07-31T00:59:32+00:00">2020-07-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-30 18:19:36" itemprop="dateModified" datetime="2021-01-30T18:19:36+00:00">2021-01-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="2PC-数据库server层"><a href="#2PC-数据库server层" class="headerlink" title="2PC (数据库server层)"></a>2PC (数据库server层)</h2><blockquote>
<p>prepare/commit/rollback</p>
</blockquote>
<ul>
<li>Prepare 阶段(事务协调者向所有参与者发起prepare): 回滚段设置为prepare；写redolog并刷盘</li>
<li>Commit 阶段(所有参与者回复待提交，向所有参与者发起commit，否则发起rollback)： 写binlog；刷盘；InnoDB commit</li>
</ul>
<h3 id="2PC崩溃恢复"><a href="#2PC崩溃恢复" class="headerlink" title="2PC崩溃恢复"></a>2PC崩溃恢复</h3><ul>
<li>Prepare 阶段崩溃: 已写redolog，commit阶段前崩溃，回滚</li>
<li>commit 阶段： 写binlog前崩溃，回滚</li>
<li>已写binlog： InnoDB commit前崩溃，重新执行commit完成提交</li>
</ul>
<h3 id="崩溃恢复过程"><a href="#崩溃恢复过程" class="headerlink" title="崩溃恢复过程"></a>崩溃恢复过程</h3><blockquote>
<p>binlog日志每次rotate时，保证没有正在提交事务，并将redolog刷盘，保证rotate时旧的binlog事务为已提交状态</p>
</blockquote>
<p>通过index找到最后一个binlog日志，遍历并解析日志中每个XID-event，判断事务是否需要回滚</p>
<h3 id="2PC问题"><a href="#2PC问题" class="headerlink" title="2PC问题"></a>2PC问题</h3><p>commit阶段某个参与者失败或超时，其他参与者是commit还是rollback</p>
<h3 id="组提交"><a href="#组提交" class="headerlink" title="组提交"></a>组提交</h3><blockquote>
<p>5.6以前对整个2PC阶段加锁，因此每个事务需刷3次盘（写 redolog，写 binlog，写 commit），性能较低</p>
</blockquote>
<ol>
<li>prepare阶段：回滚段设置为prepare</li>
<li>commit阶段<br>2.1 flush stage：写redolog并刷盘，多个线程按进入的顺序将 binlog 从 cache 写入文件（不刷盘）<br>2.2 sync stage：对 binlog 文件做 fsync 操作（多个线程的 binlog 合并一次刷盘）<br>2.3 commit stage：各个线程按顺序做 InnoDB commit 操作</li>
</ol>
<ul>
<li>每个stage为一个队列，有锁保护，第一个进入队列的线程为leader，后续进入队列为follower，队列满员后，leader领导队列全员执行stage并进入下个stage。若下个stage非空，leader注册为下个stage的follower并加入。</li>
<li>将redo操作加入组提交，提升性能</li>
<li>通过将锁粒度细化，3个阶段可并行执行，提升性能</li>
</ul>
<h3 id="XA"><a href="#XA" class="headerlink" title="XA"></a>XA</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; XA START &#39;abc&#39;,&#39;def&#39;,2;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t1 values(1,1);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; XA END &#39;abc&#39;,&#39;def&#39;,2;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; XA PREPARE &#39;abc&#39;,&#39;def&#39;,2;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; XA RECOVER;</span><br><span class="line">+----------+--------------+--------------+--------+</span><br><span class="line">| formatID | gtrid_length | bqual_length | data   |</span><br><span class="line">+----------+--------------+--------------+--------+</span><br><span class="line">|        2 |            3 |            3 | abcdef |</span><br><span class="line">+----------+--------------+--------------+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; XA COMMIT &#39;abc&#39;,&#39;def&#39;,2;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; XA START &#39;xatest&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t1 values(2,2);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; XA END &#39;xatest&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; XA RECOVER;</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; XA COMMIT &#39;xatest&#39; one phase;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; XA RECOVER;</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h2 id="最终一致性-应用层"><a href="#最终一致性-应用层" class="headerlink" title="最终一致性 (应用层)"></a>最终一致性 (应用层)</h2><p>A系统扣钱，发送信息给中间件，B系统接收信息加钱</p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>A先update DB，后发送消息，若发送失败，B无法加钱<br>A先发送消息，后update DB，若update DB失败，已发送消息无法撤回</p>
<p>将网络和DB事务放在同一个事务中，导致DB长事务</p>
<h2 id="TCC"><a href="#TCC" class="headerlink" title="TCC"></a>TCC</h2><p>应用层2PC事务最终一致性</p>
<blockquote>
<p>Try/Confirm/Cancel</p>
</blockquote>
<ul>
<li>阶段1： 协调者调用所有参与者的Try</li>
<li>阶段2:  所有Try成功后调用Confirm，否则调用Cancel</li>
</ul>
<h3 id="TCC问题"><a href="#TCC问题" class="headerlink" title="TCC问题"></a>TCC问题</h3><p>Confirm/Cancel若失败不断重试，必须等幂操作</p>
<h3 id="例"><a href="#例" class="headerlink" title="例"></a>例</h3><p>A、B、C转账，A给C转30，B给C转50，最终C +80，A -30，B -50</p>
<ul>
<li>阶段1： A锁定30，B锁定50，检查C是否可以转钱</li>
<li>阶段2: ABC开始转钱，任意一个失败不断重试</li>
</ul>
<h3 id="事务状态表-日志流水表"><a href="#事务状态表-日志流水表" class="headerlink" title="事务状态表/日志流水表"></a>事务状态表/日志流水表</h3><p>A给C转30，如何保证AC同时转账成功</p>
<p>调用方维护事务状态表，每次调用前记录流水，调用成功后更新流水状态，流水事务ID全局唯一<br>后台任务不断检查流水表，若存在长时间未成功流水，尝试重试该流水事务ID的转账，根据TCC幂等性最终保证一致性</p>
<ol>
<li>若多次重试失败，状态置未错误，需人工干预</li>
<li>若调用方调用部分成功，此时客户端可返回未知需稍后确认，等待人工处理</li>
</ol>
<h3 id="弱一致性-状态补偿"><a href="#弱一致性-状态补偿" class="headerlink" title="弱一致性 + 状态补偿"></a>弱一致性 + 状态补偿</h3><p>电商网站下单，库存库扣减，订单库累加，如何保证2个操作的原子性</p>
<ul>
<li>最终一致性方案，容易导致超卖</li>
<li>TCC强同步方案，性能不足</li>
<li>弱一致性（允许少卖，不许超卖）</li>
</ul>
<p>先扣库存再提交订单例：</p>
<ol>
<li>扣库存失败，不提交订单，返回失败，调用方重试（多扣库存）</li>
<li>扣库存成功，提交订单失败，返回失败，调用方重试（多扣库存）</li>
<li>扣库存成功，提交订单成功，返回成功。</li>
</ol>
<p>先提交订单再扣库存同理，保证库存可以多扣不能少扣</p>
<p>多扣库存补偿机制：<br>每次扣库存生成流水日志，通过关联订单系统中未支付订单和流水日志，可以回收对应库存</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://yiduoyunq.github.io/2020/07/21/mysql/backup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yiduoyunQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yiduoyunQ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/21/mysql/backup/" class="post-title-link" itemprop="url">backp</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-07-21 00:54:09" itemprop="dateCreated datePublished" datetime="2020-07-21T00:54:09+00:00">2020-07-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-30 18:19:36" itemprop="dateModified" datetime="2021-01-30T18:19:36+00:00">2021-01-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="mysqlbackup-MBE-amp-xtrabackup"><a href="#mysqlbackup-MBE-amp-xtrabackup" class="headerlink" title="mysqlbackup(MBE) &amp; xtrabackup"></a>mysqlbackup(MBE) &amp; xtrabackup</h2><p>利用mysql crash recover使用redo log恢复机制<br>FTWRL复制获取binlog点或gtid</p>
<h3 id="xtrabackup"><a href="#xtrabackup" class="headerlink" title="xtrabackup"></a>xtrabackup</h3><p>backup innoDB tables and files &amp; undo file<br>Executing FLUSH NO_WRITE_TO_BINLOG TABLES<br>Executing FLUSH TABLES WITH READ LOCK<br>backup non-InnoDB tables and files<br>Executing FLUSH NO_WRITE_TO_BINLOG ENGINE LOGS<br>The latest check point (for incremental): ‘68809340’<br>Executing UNLOCK TABLES<br>backup bufferpool<br>xtrabackup: Transaction log of lsn (68809340) to (68809349) was copied</p>
<h4 id="Executing-FLUSH-NO-WRITE-TO-BINLOG-ENGINE-LOGS"><a href="#Executing-FLUSH-NO-WRITE-TO-BINLOG-ENGINE-LOGS" class="headerlink" title="Executing FLUSH NO_WRITE_TO_BINLOG ENGINE LOGS"></a>Executing FLUSH NO_WRITE_TO_BINLOG ENGINE LOGS</h4><p>通过切换binlog并拷贝最后一个binlog，恢复时使用最后一个binlog恢复至一致点<br>若存在大事务可能无法切换binlog(flush被长时间阻塞)</p>
<h3 id="MBE"><a href="#MBE" class="headerlink" title="MBE"></a>MBE</h3><p>Starting log scan from lsn = 68824576 at offset = 66322432 and checkpoint = 68824590 in file /DBAASLOG/RED/ib_logfile0<br>backup innoDB tables and files &amp; undo file<br>backup bufferpool<br>FTWRL<br>backup non-innodb tables and files<br>Scanned log up to lsn 68824890<br>All tables unlocked</p>
<h2 id="二级备份技术"><a href="#二级备份技术" class="headerlink" title="二级备份技术"></a>二级备份技术</h2><blockquote>
<p>RTO: 灾难恢复时长<br>RPO: 灾难丢失数据时长</p>
</blockquote>
<table>
<thead>
<tr>
<th>技术点</th>
<th>RTO</th>
<th>RPO</th>
<th>消耗资源</th>
</tr>
</thead>
<tbody><tr>
<td>逻辑全量</td>
<td>小时级</td>
<td>天级</td>
<td>高</td>
</tr>
<tr>
<td>逻辑全量+逻辑日志</td>
<td>小时级</td>
<td>秒级</td>
<td>高</td>
</tr>
<tr>
<td>物理全量</td>
<td>小时级</td>
<td>天级</td>
<td>中</td>
</tr>
<tr>
<td>物理全量+物理增量</td>
<td>小时级</td>
<td>小时级</td>
<td>低</td>
</tr>
<tr>
<td>物理全量+物理增量+逻辑日志</td>
<td>小时级</td>
<td>秒级</td>
<td>低</td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://yiduoyunq.github.io/2020/07/21/mysql/mysqldump/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yiduoyunQ">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yiduoyunQ">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/21/mysql/mysqldump/" class="post-title-link" itemprop="url">mysqldump</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-07-21 00:54:09" itemprop="dateCreated datePublished" datetime="2020-07-21T00:54:09+00:00">2020-07-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-30 18:19:36" itemprop="dateModified" datetime="2021-01-30T18:19:36+00:00">2021-01-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="默认-–lock-tables-库中不同表备份点一致，不同库备份点不一致"><a href="#默认-–lock-tables-库中不同表备份点一致，不同库备份点不一致" class="headerlink" title="默认 –lock-tables  库中不同表备份点一致，不同库备份点不一致"></a>默认 –lock-tables  库中不同表备份点一致，不同库备份点不一致</h2><ol>
<li>获取gtid或file postion</li>
<li>顺序逻辑备份每个库，不同库之间备份时间点不同</li>
<li>1 同时lock库中所有表READ锁，使库变为只读</li>
<li>2 show create table + select * from table， 导出</li>
<li>3 unlock tables</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2020-11-01T16:02:01.441631Z	   18 Query	SHOW CREATE DATABASE IF NOT EXISTS &#96;test&#96;</span><br><span class="line">2020-11-01T16:02:01.441820Z	   18 Query	show tables</span><br><span class="line">2020-11-01T16:02:01.442210Z	   18 Query	LOCK TABLES &#96;employees&#96; READ &#x2F;*!32311 LOCAL *&#x2F;,&#96;t1&#96; READ &#x2F;*!32311 LOCAL *&#x2F;,&#96;test&#96; READ &#x2F;*!32311 LOCAL *&#x2F;,&#96;test_auto&#96; READ &#x2F;*!32311 LOCAL *&#x2F;</span><br><span class="line">...</span><br><span class="line">2020-11-01T16:02:04.181862Z	   18 Query	UNLOCK TABLES</span><br></pre></td></tr></table></figure>

<h2 id="–lock-all-tables-所有库备份点一致"><a href="#–lock-all-tables-所有库备份点一致" class="headerlink" title="–lock-all-tables  所有库备份点一致"></a>–lock-all-tables  所有库备份点一致</h2><p>整个数据库变为只读</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2020-11-01T16:16:57.678240Z	   21 Query	FLUSH TABLES</span><br><span class="line">2020-11-01T16:16:58.204729Z	   21 Query	FLUSH TABLES WITH READ LOCK</span><br></pre></td></tr></table></figure>

<h2 id="–single-transaction-所有innodb表备份点一致"><a href="#–single-transaction-所有innodb表备份点一致" class="headerlink" title="–single-transaction  所有innodb表备份点一致"></a>–single-transaction  所有innodb表备份点一致</h2><ol>
<li>设置会话隔离级别为RR</li>
<li>开启一个MVCC会话，START TRANSACTION /*!40100 WITH CONSISTENT SNAPSHOT */ ，开启会话时自带一次select保证备份点之后的读一致性</li>
<li>创建SAVEPOINT开始表备份，在ROLLBACK TO SAVEPOINT前对表的DDL阻塞</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">2020-11-01T16:20:35.440889Z	   22 Query	SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ</span><br><span class="line">2020-11-01T16:20:35.441080Z	   22 Query	START TRANSACTION &#x2F;*!40100 WITH CONSISTENT SNAPSHOT *&#x2F;</span><br><span class="line">...</span><br><span class="line">2020-11-01T16:20:35.451846Z	   22 Query	UNLOCK TABLES</span><br><span class="line">...</span><br><span class="line">2020-11-01T16:20:35.471418Z	   22 Query	SHOW CREATE DATABASE IF NOT EXISTS &#96;test&#96;</span><br><span class="line">2020-11-01T16:20:35.471499Z	   22 Query	SAVEPOINT sp</span><br><span class="line">2020-11-01T16:20:35.478244Z	   22 Query	show tables</span><br><span class="line">...</span><br><span class="line">2020-11-01T16:20:35.484877Z	   22 Query	show create table &#96;t1&#96;</span><br><span class="line">2020-11-01T16:20:35.486464Z	   22 Query	SELECT &#x2F;*!40001 SQL_NO_CACHE *&#x2F; * FROM &#96;t1&#96;</span><br><span class="line">2020-11-01T16:20:35.488296Z	   22 Query	ROLLBACK TO SAVEPOINT sp</span><br><span class="line">...</span><br><span class="line">2020-11-01T16:20:35.489280Z	   22 Query	show create table &#96;test&#96;</span><br><span class="line">2020-11-01T16:20:35.497826Z	   22 Query	SELECT &#x2F;*!40001 SQL_NO_CACHE *&#x2F; * FROM &#96;test&#96;</span><br><span class="line">2020-11-01T16:20:38.400419Z	   22 Query	ROLLBACK TO SAVEPOINT sp</span><br><span class="line">...</span><br><span class="line">2020-11-01T16:20:38.403299Z	   22 Query	RELEASE SAVEPOINT sp</span><br></pre></td></tr></table></figure>

<h2 id="–single-transaction-–master-data-2-需2次flush关表"><a href="#–single-transaction-–master-data-2-需2次flush关表" class="headerlink" title="–single-transaction + –master-data=2    需2次flush关表"></a>–single-transaction + –master-data=2    需2次flush关表</h2><p>–master-data需导出当前binlog位点，因此需FTWRL将数据库数据达到一致</p>
<ol>
<li>flush tables + FTWRL 整个数据库达到一致</li>
<li>设置RR，开启一致读会话</li>
<li>通过show master status获取binlog位点</li>
<li>UNLOCK TABLES</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">2020-11-01T16:47:40.165353Z	   23 Query	FLUSH &#x2F;*!40101 LOCAL *&#x2F; TABLES</span><br><span class="line">2020-11-01T16:47:40.190316Z	   23 Query	FLUSH TABLES WITH READ LOCK</span><br><span class="line">2020-11-01T16:47:40.190471Z	   23 Query	SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ</span><br><span class="line">2020-11-01T16:47:40.190537Z	   23 Query	START TRANSACTION &#x2F;*!40100 WITH CONSISTENT SNAPSHOT *&#x2F;</span><br><span class="line">2020-11-01T16:47:40.190744Z	   23 Query	SHOW VARIABLES LIKE &#39;gtid\_mode&#39;</span><br><span class="line">2020-11-01T16:47:40.202013Z	   23 Query	SHOW MASTER STATUS</span><br><span class="line">2020-11-01T16:47:40.204813Z	   23 Query	UNLOCK TABLES</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><p>mysql –max-allowed-packet=16MB -BNe “SELECT SCHEMA_NAME FROM INFORMATION_SCHEMA.SCHEMATA WHERE SCHEMA_NAME NOT IN (‘mysql’, ‘performance_schema’, ‘information_schema’, ‘sys’)” | tr ‘\n’ ‘ ‘ &gt; dbs.sql<br>mysqldump  –opt –add-drop-database –add-drop-table –complete-insert –default-character-set=utf8 –hex-blob –master-data=2 –quote-names –single-transaction –events –routines –triggers –databases $(cat dbs.sql) &gt; full_dump.sql</p>
<ul>
<li><p>-q, –quick   Don’t buffer query, dump directly to stdout. (Defaults to on; use –skip-quick to disable.)</p>
</li>
<li><p>–opt : Shorthand for –add-drop-table –add-locks –create-options –extended-insert –lock-tables –quick –set-charset</p>
</li>
<li><p>–lock-tables Lock all tables before dumping them</p>
</li>
<li><p>–single-transaction Issue a BEGIN SQL statement before dumping data from server</p>
</li>
<li><p>–hex-blob Dump binary columns using hexadecimal notation (for example, ‘abc’ becomes 0x616263)</p>
</li>
<li><p>–master-data=2 Write the binary log file name and position to the output as an SQL comment</p>
</li>
<li><p>–max-allowed-packet Maximum packet length to send to or receive from server</p>
</li>
<li><p>–events</p>
</li>
<li><p>–routines</p>
</li>
<li><p>–triggers</p>
</li>
<li><p>–complete-insert Use complete INSERT statements that include column names</p>
</li>
<li><p>–set-charset Add SET NAMES default_character_set to output</p>
</li>
<li><p>–add-drop-database</p>
</li>
<li><p>–add-drop-table</p>
</li>
<li><p>–add-locks</p>
</li>
<li><p>–default-character-set=utf8</p>
</li>
<li><p>–quick 流式取数据，非单次填充整个结果集到内存</p>
</li>
<li><p>–extended-insert Use multiple-row INSERT syntax</p>
</li>
<li><p>–create-options Include all MySQL-specific table options in CREATE TABLE statements</p>
</li>
<li><p>–flush-logs Flush MySQL server log files before starting dump</p>
</li>
<li><p>–lock-all-tables Lock all tables across all databases</p>
</li>
<li><p>–set-gtid-purged Whether to add SET @@GLOBAL.GTID_PURGED to output</p>
</li>
<li><p>–databases</p>
</li>
<li><p>–tables</p>
</li>
<li><p>–no-create-db</p>
</li>
<li><p>–no-create-info</p>
</li>
<li><p>–no-data</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">yiduoyunQ</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">33</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yiduoyunQ</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
